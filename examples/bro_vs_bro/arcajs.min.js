arcajs={},arcajs.infra={addPointerEventListener:function(e,n){var t=r=>{for(let e=0,t=this.normalizeEvents(r);e<t.length;++e)n(t[e]);return!0};void 0!==e.style.touchAction&&(e.style.touchAction="none"),e.oncontextmenu=e=>!1,this.normalizeEvents.pointerDown=[],window.PointerEvent?e.onpointerdown=e.onpointermove=e.onpointerup=e.onpointerout=e.onpointerenter=e.onpointerleave=t:e.ontouchstart=e.ontouchend=e.ontouchmove=t},normalizeEvents:function(a){let o=this.normalizeEvents.pointerDown;function s(r){for(let e=0,t=o.length;e!=t;++e)if(o[e]==r)return e}function u(e){for(let e=0;;++e)if(void 0===o[e])return e}let l=[];if(window.PointerEvent){let e,t=null;if(a.type in{pointerdown:!0,pointerenter:!0}){if("mouse"!==a.pointerType)e=u(a.pointerId);else switch(a.button){case 1:e=2;break;case 2:e=1;break;default:e=a.button}0<=e&&(t="start",o[e]=a.pointerId)}else if(a.type in{pointerup:!0,pointerout:!0,pointerleave:!0}){if(e=s(a.pointerId),void 0===e)return!1;t="end",delete o[e]}else"pointermove"==a.type&&(e=s(a.pointerId),void 0!==e?t="move":"mouse"==a.pointerType&&(t="hover"));t&&l.push({type:t,target:a.target,id:e||0,pointerType:a.pointerType,pageX:a.pageX,pageY:a.pageY,clientX:a.clientX,clientY:a.clientY,x:a.offsetX,y:a.offsetY,timeStamp:Math.round(a.timeStamp)})}else if(a.type in{touchstart:!0,touchmove:!0,touchend:!0,touchcancel:!0,touchleave:!0}){a.preventDefault();let e=a.target,n=0,i=0;for(;e&&void 0!==e.offsetLeft;)n+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;for(let r=0;r<a.changedTouches.length;++r){var c=a.changedTouches[r];let e,t=a.type.substr(5);if("start"==t)e=u(c.identifier),o[e]=c.identifier;else{if(e=s(c.identifier),void 0===e)continue;"cancel"!=t&&"leave"!=t||(t="end"),"end"==t&&delete o[e]}l.push({type:t,id:e,pointerType:"touch",pageX:c.pageX,pageY:c.pageY,clientX:c.clientX,clientY:c.clientY,x:c.clientX-n,y:c.clientY-i,timeStamp:Math.round(a.timeStamp)})}}return!!l.length&&l}},arcajs.http={encodeURI:function(e){var t,r="";for(t in e){r.length&&(r+="&");var n=e[t];"object"==typeof n&&(n=JSON.stringify(n)),r+=t+"="+encodeURIComponent(n)}return r},request:function(e,n,t,i){const a=(r=(r=n).toLowerCase()).endsWith(".png")||r.endsWith(".jpg")?"image":r.endsWith(".wav")||r.endsWith(".mp3")?"audio":r.endsWith(".ttf")?"font":"";var r;const o=new XMLHttpRequest;try{o.open(e,n,!0),this.timeout&&(o.timeout=this.timeout),t&&"POST"==e?o.setRequestHeader("Content-type","application/x-www-form-urlencoded"):"GET"==e&&a&&(o.responseType="blob"),i&&(o.onload=o.onerror=o.ontimeout=function(e){var t=void 0===o.status?-1:1223==o.status?204:o.status,r=(r=o).contentType||("getResponseHeader"in r?r.getResponseHeader("Content-Type"):"")||"",r=-1==o.status||204==o.status?null:"application/json"==r?JSON.parse(o.responseText):a?o.response:o.responseText;if("error"==e.type?console.error(n,e):"timeout"==e.type&&(t=408),r===o.response)return function(e,u,l,c){if("image"===u){const n=document.createElement("img");n.src=URL.createObjectURL(e),n.onload=()=>{URL.revokeObjectURL(n.src);let e=document.createElement("canvas");e.width=n.width,e.height=n.height;let t=e.getContext("2d");t.drawImage(n,0,0,e.width,e.height);var r=new Uint8Array(t.getImageData(0,0,e.width,e.height).data.buffer);c({width:n.width,height:n.height,depth:4,data:r,mediaType:u},l)}}else{var t;"audio"===u?((t=new FileReader).onload=function(){const e=new AudioContext;e.decodeAudioData(t.result,e=>{var t=e.numberOfChannels,r=e.getChannelData(0),n=r.length;const i=1==t?r:new Float32Array(t*n);if(1<t){const s=[r];for(var a=1;a<t;++a)s.push(e.getChannelData(a));for(a=0;a<n;++a)for(var o=0;o<t;++o)i[a*t+o]=s[o][a]}c({samples:i,channels:t,offset:0,mediaType:u},l)})},t.readAsArrayBuffer(e)):console.error("readBinaryData",u,"not yet implemented")}}(r,a,t,i);i(r,t)}),o.send(t&&"POST"==e?this.encodeURI(t):null)}catch(e){return console&&console.error(e),i&&i(e,-2),!1}return o},get:function(e,t,r){return t&&(e+="?"+this.encodeURI(t)),this.request("GET",e,null,r)},post:function(e,t,r){return this.request("POST",e,t,r)},timeout:32e3},arcajs.intersects={transform:function(e,t,r,n=0){for(var i=Math.cos(n),a=Math.sin(n),o=0,s=e.length;o<s;o+=2){var u=e[o],l=e[o+1];e[o]=u*i-l*a+t,e[o+1]=u*a+l*i+r}},transformInv:function(e,t,r,n=0){for(var i=Math.cos(-n),a=Math.sin(-n),o=0,s=e.length;o<s;o+=2){var u=e[o]-t,l=e[o+1]-r;e[o]=u*i-l*a,e[o+1]=u*a+l*i}},pointCircle:function(e,t,r,n,i){e=r-e,t=n-t;return e*e+t*t<i*i},pointAlignedRect:function(e,t,r,n,i,a){return i<e||e<r||a<t||t<n?0:1},pointPolygon:function(e,t,r){if(r.length<6)return!1;for(var n=0,i=0,a=0;a<r.length;a+=2){var o=r[a],s=r[a+1];if(e==o&&t==s)return!0;var u=r[(a+2)%r.length],o=(e-o)*(r[(a+3)%r.length]-s)-(t-s)*(u-o);if(0<o?n++:o<0&&i++,0<n&&0<i)return!1}return!0},circleCircle:function(e,t,r,n,i,a){e=n-e,t=i-t,a=r+a;return e*e+t*t<a*a},circleAlignedRect:function(e,t,r,n,i,a,o){if(e<n-r||a+r<=e||t<i-r||o+r<=t)return!1;if(e<n){if(t<i)return(s=n-e)*s+(u=i-t)*u<r*r;if(o<t)return(s=n-e)*s+(u=t-o)*u<r*r}else if(a<e){var s,u;if(t<i)return(s=e-a)*s+(u=i-t)*u<r*r;if(o<t)return(s=e-a)*s+(u=t-o)*u<r*r}return!0},circleTriangle:function(e,t,r,n,i,a,o,s,u){var l=r*r,c=e-n,h=t-i,f=c*c+h*h-l;if(f<=0)return!0;var d=e-a,g=t-o,p=d*d+g*g-l;if(p<=0)return!0;var m=e-s,r=t-u,e=m*m+r*r-l;if(e<=0)return!0;t=a-n,l=o-i,a=s-a,o=u-o,s=n-s,u=i-u;if(t*h<=l*c){if(a*g<=o*d&&s*r<=u*m)return!0}else if(o*d<a*g&&u*m<s*r)return!0;h=c*t+h*l;if(0<h){var v=t*t+l*l;if(h<v&&f*v<=h*h)return!0}if(0<(h=d*a+g*o)){v=a*a+o*o;if(h<v&&p*v<=h*h)return!0}if(0<(h=m*s+r*u)){v=s*s+u*u;if(h<v&&e*v<=h*h)return!0}return!1},circlePolygon:function(e,t,r,n){if(n.length<6)return!1;for(var i=r*r,a=0,o=n.length;a<o;a+=2){var s=n[a]-e,u=n[a+1]-t;if(s*s+u*u<i)return!0}if(this.pointPolygon(e,t,n))return!0;for(a=0,o=n.length;a<o;a+=2){var l=n[a],c=n[a+1],h=n[(a+2)%n.length]-l,f=n[(a+3)%n.length]-c,d=e-l,l=t-c,c=(h*d+f*l)/(h*h+f*f);if(!(c<0||1<c)){h=d-h*c,c=l-f*c;if(h*h+c*c<i)return!0}}return!1},circleTriangles:function(e,t,r,n,i=0,a=0,o=0){var s=[e,t];this.transformInv(s,i,a,o);for(var u=0,l=Math.floor(n.length/6);u<l;++u)if(this.circleTriangle(s[0],s[1],r,n[6*u],n[6*u+1],n[6*u+2],n[6*u+3],n[6*u+4],n[6*u+5]))return!0;return!1},alignedRectAlignedRect:function(e,t,r,n,i,a,o,s){return!(r<i||o<e)&&!(n<a||s<t)},triangleTriangle:function(e,t,r,n,i,a,o,s,u,l,c,h){function f(e,t,r,n,i,a,o,s,u,l){return!((n-=t)*(i-e)<=(r-=e)*(a-t))&&(!(n*(o-e)<=r*(s-t))&&r*(l-t)<n*(u-e))}return!f(e,t,r,n,o,s,u,l,c,h)&&(!f(r,n,i,a,o,s,u,l,c,h)&&(!f(i,a,e,t,o,s,u,l,c,h)&&(!f(o,s,u,l,e,t,r,n,i,a)&&(!f(u,l,c,h,e,t,r,n,i,a)&&!f(c,h,o,s,e,t,r,n,i,a)))))},polygonPolygon:function(e,t){for(var r,n,i,a,o=[e,t],s=0;s<o.length;s++)for(var u=o[s],l=0;l<u.length;l+=2){for(var c=(l+2)%u.length,h=u[l],f=u[l+1],d=u[c],g=u[1+c]-f,p=h-d,m=r=void 0,v=0;v<e.length;v+=2)n=g*e[v]+p*e[v+1],(void 0===m||n<m)&&(m=n),(void 0===r||r<n)&&(r=n);for(i=a=void 0,v=0;v<t.length;v+=2)n=g*t[v]+p*t[v+1],(void 0===i||n<i)&&(i=n),(void 0===a||a<n)&&(a=n);if(r<i||a<m)return!1}return!0},polygonTriangles:function(e,t,r,n,i,a=0,o=0,s=0){let u=e;(t||r||n)&&(u=e.slice(0),this.transform(u,t,r,n));for(var l=0,c=Math.floor(i.length/6);l<c;++l){var h=i.slice(6*l,6*l+6);if((a||o||s)&&this.transform(h,a,o,s),this.polygonPolygon(u,h))return!0}return!1},trianglesTriangles:function(e,t,r,n,i,a=0,o=0,s=0){for(var u=0,l=Math.floor(e.length/6);u<l;++u){var c=e.slice(6*u,6*u+6);(t||r||n)&&this.transform(c,t,r,n);for(var h=0,f=Math.floor(i.length/6);h<f;++h){var d=i.slice(6*h,6*h+6);if((a||o||s)&&this.transform(d,a,o,s),this.triangleTriangle(...c,...d))return!0}}return!1},spritesCoarse:function(e,t){var r=this;if(0<=e.radius&&0<=t.radius)return r.circleCircle(e.x,e.y,e.radius,t.x,t.y,t.radius);if(0<=e.radius){if(!t.rot){var n=t.x-t.cx*t.w||0,i=t.y-t.cy*t.h||0;return r.circleAlignedRect(e.x,e.y,e.radius,n,i,n+t.w,i+t.h)}var a=[e.x,e.y];const h=-t.cx*t.w||0,f=-t.cy*t.h||0;n=[h,f,h,f+t.h,h+t.w,f+t.h,h+t.w,f];return r.transformInv(a,t.x,t.y,t.rot),r.circlePolygon(a[0],a[1],e.radius,n)}if(0<=t.radius){if(!e.rot){var o=e.x-e.cx*e.w||0,s=e.y-e.cy*e.h||0;return r.circleAlignedRect(t.x,t.y,t.radius,o,s,o+e.w,s+e.h)}var u=[t.x,t.y];const h=-e.cx*e.w||0,f=-e.cy*e.h||0;var l=[h,f,h,f+e.h,h+e.w,f+e.h,h+e.w,f];return r.transformInv(u,e.x,e.y,e.rot),r.circlePolygon(u[0],u[1],t.radius,l)}if(!e.rot&&!t.rot){var i=e.x-e.cx*e.w||0,a=e.y-e.cy*e.h||0,n=i+e.w,o=a+e.h,s=t.x-t.cx*t.w||0,u=t.y-t.cy*t.h||0,l=s+t.w,c=u+t.h;return r.alignedRectAlignedRect(i,a,n,o,s,u,l,c)}let h=-e.cx*e.w||0,f=-e.cy*e.h||0;c=[h,f,h,f+e.h,h+e.w,f+e.h,h+e.w,f];r.transform(c,e.x,e.y,e.rot),h=-t.cx*t.w||0,f=-t.cy*t.h||0;e=[h,f,h,f+t.h,h+t.w,f+t.h,h+t.w,f];return r.transform(e,t.x,t.y,t.rot),r.polygonPolygon(c,e)},sprites:function(e,t){const n=this;var r,i,a,o=n.spritesCoarse(e,t);if(!o||!e.shape&&!t.shape&&!e.triangles&&!t.triangles)return o;if(e.shape&&t.shape){var s=e.shape,u=t.shape;return(e.x||e.y||e.rot)&&(s=new Float32Array(s),n.transform(s,e.x,e.y,e.rot)),(t.x||t.y||t.rot)&&(u=new Float32Array(u),n.transform(u,t.x,t.y,t.rot)),n.polygonPolygon(s,u)}if(e.triangles&&t.triangles)return n.trianglesTriangles(e.triangles,e.x,e.y,e.rot,t.triangles,t.x,t.y,t.rot);function l(e){var t=-e.cx*e.w||0,r=-e.cy*e.h||0,r=[t,r,t,r+e.h,t+e.w,r+e.h,t+e.w,r];return(e.x||e.y||e.rot)&&n.transform(r,e.x,e.y,e.rot),r}if(s=e.shape?(i=e.shape,r=e,t):(i=t.shape,r=t,e),i){if(s.triangles)return n.polygonTriangles(r.shape,r.x,r.y,r.rot,s.triangles,s.x,s.y,s.rot);if(0<=s.radius){u=[s.x,s.y];return n.transformInv(u,r.x,r.y,r.rot),n.circlePolygon(u[0],u[1],s.radius,i)}const c=l(s);return(r.x||r.y||r.rot)&&(i=new Float32Array(i),n.transform(i,r.x,r.y,r.rot)),n.polygonPolygon(c,i)}if(0<=(e=e.triangles?(a=e,t):(a=t,e)).radius)return n.circleTriangles(e.x,e.y,e.radius,a.triangles,a.x,a.y,a.rot);const c=l(e);return n.polygonTriangles(c,0,0,0,a.triangles,a.x,a.y,a.rot)}};"use strict";arcajs.Graphics=function(){let O=new function(){var e=new Int8Array(4);let i=new Uint32Array(e.buffer,0,1),a=new Float32Array(e.buffer,0,1),r=new Int16Array(e.buffer,0,2);this.rgba=function(e,t,r,n=255){return i[0]=4278190079&(n<<24|r<<16|t<<8|e),a[0]},this.int14=function(e,t=0){return r[0]=e,r[1]=t,a[0]}};function P(e,t,r){Object.defineProperty(e,t,{value:r,writable:!1,enumerable:!0,configurable:!0})}function S(e,t,r){t=e.createShader(t);if(e.shaderSource(t,r),e.compileShader(t),e.getShaderParameter(t,e.COMPILE_STATUS))return t;console.error(e.getShaderInfoLog(t)),e.deleteShader(t)}return function(i,b=500){const e=4,t=4;var r=6*t;let a=new Float32Array(b*r),E=0,o=0,s=new Float32Array([1,0,0,0,1,0,0,0,1]),h=[new Float32Array([0,0,0,1,O.rgba(255,255,255),1])];function u(e,t){t[0]=Math.cos(e[2])*e[3],t[3]=-Math.sin(e[2])*e[3],t[6]=e[0],t[1]=-t[3],t[4]=t[0],t[7]=e[1]}let n=1;const A=16383;let m=[],_=[],l=null;const c=i.getContext("webgl")||i.getContext("experimental-webgl");var f,r=function(e,t,r){var n=S(e,e.VERTEX_SHADER,t),t=S(e,e.FRAGMENT_SHADER,r),r=e.createProgram();if(e.attachShader(r,n),e.attachShader(r,t),e.linkProgram(r),e.getProgramParameter(r,e.LINK_STATUS))return r;console.error(e.getProgramInfoLog(r)),e.deleteProgram(r)}(c,`
// input from vertex buffer:
attribute vec2 a_position;
attribute vec4 a_color;
attribute vec2 a_texCoord;
// output to fragment shader:
varying vec4 vtxColor;
varying vec2 texCoord;
// context shared across all vertices in this batch:
uniform vec2 u_resolution;
uniform mat3 u_matrix;

void main() {
	vec2 position = (u_matrix * vec3(a_position, 1)).xy;
	// convert the rectangle from pixels to 0.0 to 1.0
	vec2 zeroToOne = position / u_resolution;

	// convert from 0->1 to 0->2
	vec2 zeroToTwo = zeroToOne * 2.0;

	// convert from 0->2 to -1->+1 (clipspace)
	vec2 clipSpace = zeroToTwo - 1.0;

	gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
	vtxColor = a_color;
	texCoord = a_texCoord / vec2(16383.0,16383.0);
}`,`
precision mediump float;

uniform sampler2D u_texUnit0;

varying vec4 vtxColor;
varying vec2 texCoord;

void main() {
	vec4 texColor = texture2D(u_texUnit0, texCoord);
	gl_FragColor = vtxColor * texColor;
}`);const d=c.getAttribLocation(r,"a_position");c.enableVertexAttribArray(d);const g=c.getAttribLocation(r,"a_color");c.enableVertexAttribArray(g);const p=c.getAttribLocation(r,"a_texCoord");c.enableVertexAttribArray(p);let v=c.getUniformLocation(r,"u_resolution"),y=c.getUniformLocation(r,"u_matrix"),x=c.getUniformLocation(r,"u_texUnit0");function w(t){var r=A/t.width,n=A/t.height;let i=[];for(let e=0;e<t.glyphs.length;++e){var a=t.glyphs[e],o=a.x*r,s=a.y*n;i.push({xoff:a.xoff,yoff:a.yoff,w:a.w,h:a.h,tx1:o,ty1:s,tx2:o+a.w*r,ty2:s+a.h*n})}return i}function T(e){var t="filtering"in e?e.filtering:1,r="repeat"in e&&e.repeat,e=1<t?c.LINEAR_MIPMAP_LINEAR:1==t?c.LINEAR:c.NEAREST;c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r?c.REPEAT:c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r?c.REPEAT:c.CLAMP_TO_EDGE),1<t&&c.generateMipmap(c.TEXTURE_2D)}function R(){switch(n){case 0:c.blendFunc(c.ONE,c.ZERO);break;case 1:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);break;case 2:c.blendFuncSeparate(c.SRC_ALPHA,c.ONE,c.ZERO,c.ONE);break;case 4:c.blendFuncSeparate(c.DST_COLOR,c.ZERO,c.ZERO,c.ONE);break;case 8:c.blendFuncSeparate(c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA,c.DST_COLOR,c.ONE_MINUS_SRC_ALPHA)}}c.useProgram(r),this.loadFont=function(n,i={},a){if("ttf"==n.substr(n.lastIndexOf(".")+1).toLowerCase()){let t=n.substr(0,n.indexOf("."));t=t.toLowerCase().split("-").map(e=>e.charAt(0).toUpperCase()+e.substring(1)).join(" ");let r=m.length,e=new FontFace(t,"url("+n+")");return e.load().then(e=>{document.fonts.add(e),this.loadFont(i.size+"px "+t,{fontId:r},a)}).catch(e=>{console.error("loading font resource",n,"failed:",e)}),m.push({texture:null,glyphs:null,size:i.size,width:0,height:0,ready:!1}),r}var e=function(e){let t=document.createElement("canvas");t.width=1024,t.height=1024;let r=t.getContext("2d");r.font=e,r.textBaseline="top";let n=[],i=0,a=0,o=0;for(let t=32;t<256;++t){var s=String.fromCharCode(t),s=r.measureText(s);let e={w:Math.ceil(s.width),h:Math.ceil(s.actualBoundingBoxAscent+s.actualBoundingBoxDescent)+4,xoff:0,yoff:Math.floor(-s.actualBoundingBoxAscent)-1};1024<i+e.w&&(a+=o+2,o=i=0);s=e.h+e.yoff;s>o&&(o=s),e.x=i,e.y=a+e.yoff,n.push(e),i+=e.w+1}t.height=a+o,r.fillStyle="white",r.font=e,r.textBaseline="top",i=0,a=0,o=0;for(let e=32;e<256;++e){var u=String.fromCharCode(e),l=n[e-32];1024<i+l.w&&(a+=o+2,o=i=0);var c=l.h+l.yoff;c>o&&(o=c),r.fillText(u,i+.5,a+.5),i+=l.w+1}return{data:r.getImageData(0,0,t.width,t.height).data,width:t.width,height:t.height,glyphs:n}}(n),t=c.createTexture();c.bindTexture(c.TEXTURE_2D,t),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e.width,e.height,0,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array(e.data.buffer)),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);var r="fontId"in i?i.fontId:m.length;return m[r]={texture:t,glyphs:w(e),width:e.width,height:e.height,ready:!0},a&&a(),r},this.loadTexture=function(e,n={},t){let i={texture:c.createTexture(),ready:!1,x:0,y:0,width:1,height:1,cx:0,cy:0,sc:1};c.bindTexture(c.TEXTURE_2D,i.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,1,1,0,c.RGBA,c.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var r=()=>{if(c.bindTexture(c.TEXTURE_2D,i.texture),"scale"in n){let e=document.createElement("canvas");e.width=Math.ceil(a.width*n.scale),e.height=Math.ceil(a.height*n.scale);let t=e.getContext("2d");t.drawImage(a,0,0,e.width,e.height);var r=new Uint8Array(t.getImageData(0,0,e.width,e.height).data.buffer);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e.width,e.height,0,c.RGBA,c.UNSIGNED_BYTE,r),i.width=e.width,i.height=e.height}else c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a),i.width=a.width,i.height=a.height;("centerX"in n||"centerY"in n)&&(i.cx=n.centerX||0,i.cy=n.centerY||0),i.cx&&(i.cx*=i.width),i.cy&&(i.cy*=i.height),T(n),i.ready=!0,delete i.img,t&&t(i)};let a=i.img=new Image;return a.src=e,a.complete?setTimeout(r,0):a.addEventListener("load",r),_.push(i),_.length-1},this.createTexture=function(e,t,r,n={}){var i;"object"==typeof e&&(e=(i=e).width,t=i.height,r=i.data);let a={texture:c.createTexture(),x:0,y:0,width:e,height:t,cx:0,cy:0,sc:1,ready:!0};return c.bindTexture(c.TEXTURE_2D,a.texture),r=Array.isArray(r)?new Uint8Array(r):new Uint8Array(r.buffer),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e,t,0,c.RGBA,c.UNSIGNED_BYTE,r),("centerX"in n||"centerY"in n)&&(a.cx=n.centerX*e,a.cy=n.centerY*t),T(n),_.push(a),_.length-1},this.createCircleTexture=function(e,t=[255,255,255,255],r=0,n=[0,0,0,0]){let i=document.createElement("canvas");i.width=i.height=Math.ceil(2*e+r);let a=i.getContext("2d");a.lineWidth=r,a.fillStyle=t?"rgba("+t[0]+","+t[1]+","+t[2]+","+("number"==typeof t[3]?t[3]/255:1)+")":"transparent",a.strokeStyle=r?"rgba("+n[0]+","+n[1]+","+n[2]+","+("number"==typeof n[3]?n[3]/255:1)+")":"transparent",a.beginPath(),a.arc(e+r/2,e+r/2,e,0,2*Math.PI,!0),a.closePath(),t&&a.fill(),r&&a.stroke();r=new Uint8Array(a.getImageData(0,0,i.width,i.height).data.buffer),r=this.createTexture(i.width,i.height,r);return this.setTextureCenter(r,.5,.5),r},this.createTileTexture=function(r,n,i,a,o,s){const u=_[r];if(!u)return console.error("createTileTexture() invalid parent id",r);const l=_.length;_.push({});var e=()=>{a*=u.width,o*=u.height;var e=s&&"centerX"in s?s.centerX:u.cx/u.width,t=s&&"centerY"in s?s.centerY:u.cy/u.height;_[l]={texture:u.texture,x:u.width*n,y:u.height*i,width:a,height:o,cx:a*e,cy:o*t,sc:u.sc,ready:u.ready,parent:u.parent||r}};return u.ready?e():u.img&&u.img.addEventListener("load",e),l},this.createTileTextures=function(s,u,l,c,e){"string"==typeof s&&(s=this.loadTexture(s,e));const h=_[s];if(!h)return console.error("createTileTextures() invalid parent id",s);const t=_.length;for(let e=0,t=u*l;e<t;++e)_.push({parent:h.parent||s,ready:h.ready});e=()=>{var r=h.width/u,n=r-2*c,i=h.height/l,a=i-2*c;let o=t;for(let t=0;t<l;++t)for(let e=0;e<u;++e)_[o++]={texture:h.texture,x:r*e+c,y:i*t+c,width:n,height:a,cx:h.cx/u,cy:h.cy/l,sc:h.sc,ready:h.ready,parent:h.parent||s}};return h.ready?e():h.img&&h.img.addEventListener("load",e),t},this.releaseTexture=function(e){const t=_[e];t&&(t.texture&&(c.deleteTexture(t.texture),t.texture=0),t.w=t.h=0,t.ready=!1)},this.createImageFontResource=function(n,e){"string"==typeof n&&(n=this.loadTexture(n,e));let i=this.queryTexture(n);if(!i)return console.error("createImageFontResource() invalid parent image id",n);const a="object"==typeof e&&"border"in e?e.border:0;e="fontId"in e?e.fontId:m.length;const o=_[n],s=m[e]={texture:null,glyphs:[],width:0,height:0,ready:!1},t=e=>{e&&(i=this.queryTexture(n)),s.texture=o.texture,s.width=i.width,s.height=i.height;var t=Math.floor(i.width/16),r=Math.floor(i.height/16);for(let e=32;e<256;++e)s.glyphs.push({x:t*(e%16)+a,y:r*Math.floor(e/16)+a,w:t-2*a,h:r-2*a,xoff:0,yoff:0});s.glyphs=w(s),s.ready=!0};return o.ready?t(!1):o.img&&o.img.addEventListener("load",()=>{t(!0)}),e},this.queryTexture=function(e){if(!e||e<1||e>=_.length)return null;e=_[e];return{width:e.width,height:e.height,sc:e.sc,cx:e.cx/e.width,cy:e.cy/e.height,ready:e.ready}},this.setTextureCenter=function(e,r,n){if(0<e&&e<_.length){const i=_[e];e=()=>{var e=i.width||1,t=i.height||1;i.cx=r*e,i.cy=n*t};if(i.ready)e();else{const t=i.img||(i.parent?_[i.parent].img:null);t&&t.addEventListener("load",e)}}};const L=e=>(e.texture!=l&&(this.flush(),l=e.texture),e);function C(e,t,r=1,n=1){a[o++]=e,a[o++]=t,a[o++]=h[h.length-1][4],a[o++]=O.int14(r,n)}this.color=function(e,t,r,n=255){var i;return Array.isArray(e)?h[h.length-1][4]=O.rgba(e[0],e[1],e[2],e[3]):(void 0===t?(e=(4278190080&(i=e))>>>24,t=(16711680&i)>>>16,r=(65280&i)>>>8,n=255&i):void 0===r&&(n=t,e=(4278190080&(i=e))>>>24,t=(16711680&i)>>>16,r=(65280&i)>>>8),h[h.length-1][4]=O.rgba(e,t,r,n)),this},this.colorf=function(e,t,r,n=1){return h[h.length-1][4]=O.rgba(255*e,255*t,255*r,255*n),this},this.lineWidth=function(e){return void 0===e?h[h.length-1][5]:(e==h[h.length-1][5]||(this.flush(),h[h.length-1][5]=Number(e)),this)},this.blend=function(e){return void 0===e?n:(e===n||(this.flush(),n=e,R()),this)},this.save=function(){return h.length<8&&h.push(h[h.length-1].slice()),this},this.transform=function(e,t,r=0,n=1){this.flush();const i=h[h.length-1];return"object"==typeof e?(i[0]+=s[0]*e.x+s[3]*e.y,i[1]+=s[1]*e.x+s[4]*e.y,"rot"in e&&(i[2]+=e.rot),"sc"in e&&(i[3]*=e.sc)):(i[0]+=s[0]*e+s[3]*t,i[1]+=s[1]*e+s[4]*t,i[2]+=r,i[3]*=n),u(i,s),this},this.setTransform=function(e,t,r=0,n=1){this.flush();const i=h[h.length-1];return i[0]=e,i[1]=t,i[2]=r,i[3]=n,u(i,s),this},this.restore=function(){var e=h.length;return e<2||(this.flush(),h.pop(),u(h[e-2],s)),this},this.reset=function(){return this.flush(),h.length=1,h[0][0]=h[0][1]=h[0][2]=0,h[0][3]=h[0][5]=1,h[0][4]=O.rgba(255,255,255),u(h[0],s),this},this.fillText=function(t,r,e,n=0,i=0){var a=m[n];if(void 0===a||null===a.texture)return console.error("font not ready",a);L(a),0!==i&&(n=this.measureText(n,e),i&this.ALIGN_RIGHT?t-=n.width:i&this.ALIGN_CENTER&&(t-=n.width/2),i&this.ALIGN_BOTTOM?r-=n.height:i&this.ALIGN_MIDDLE&&(r-=n.height/2));const o=String(e);for(let e=0;e<o.length;++e){var s,u,l,c,h,f,d,g,p=o.charCodeAt(e);p<32||256<p||(u=t+(s=a.glyphs[p-32]).xoff,l=r+s.yoff,c=u+s.w,h=l+s.h,f=s.tx1,d=s.ty1,g=s.tx2,p=s.ty2,C(u,l,f,d),C(c,l,g,d),C(u,h,f,p),C(u,h,f,p),C(c,l,g,d),C(c,h,g,p),++E==b&&this.flush(),t+=s.w)}},this.measureText=function(e,r){var n=m[e];if(void 0===n||null===n.glyphs||!n.ready)return null;var t=n.glyphs[92],e=n.glyphs[45];let i={height:t.yoff+t.h,fontBoundingBoxAscent:e.h,fontBoundingBoxDescent:t.yoff+t.h-e.yoff-e.h};if(void 0!==r){"string"!=typeof r&&(r=""+r);for(let t=i.width=0;t<r.length;++t){let e=r.charCodeAt(t);(e<32||256<e)&&(e=32);var a=n.glyphs[e-32];i.width+=a.w}}return i},this.clipRect=function(e,t,r,n){this.flush(),"number"==typeof e?(c.enable(c.SCISSOR_TEST),c.scissor(e,i.height-t-n,r,n)):(c.scissor(0,0,i.width,i.height),c.disable(c.SCISSOR_TEST))},this.fillRect=function(e,t,r,n){L(I);r=e+r,n=t+n;C(e,t),C(r,t),C(e,n),C(e,n),C(r,t),C(r,n),++E==b&&this.flush()},this.drawRect=function(e,t,r,n){var i=h[h.length-1][5],a=i/2,r=e+r,i=(t+=a)+n-i;this.drawLine(e,t,r,t),this.drawLine(r-a,t+a,r-a,i-a),this.drawLine(r,i,e,i),this.drawLine(e+a,i-a,e+a,t+a)},this.drawLine=function(e,t,r,n){L(I);var i=r-e,a=n-t,o=Math.sqrt(i*i+a*a),s=h[h.length-1][5]/2,u=s*-a/o,l=s*i/o,a=e+u,s=t+l,i=r+u,o=n+l;r-=u,n-=l,C(e-=u,t-=l),C(r,n),C(a,s),C(a,s),C(r,n),C(i,o),++E==b&&this.flush()},this.drawPoints=function(r){var n=h[h.length-1][5],i=n/2;if(n<=2)for(let e=0,t=r.length-1;e<t;e+=2)this.fillRect(r[e]-i,r[e+1]-i,n,n);else{L(_[M]);var a=A,o=A;for(let e=0,t=r.length-1;e<t;e+=2){var s=r[e]-i,u=r[e+1]-i,l=s+n,c=u+n;C(s,u,0,0),C(l,u,a,0),C(s,c,0,o),C(s,c,0,o),C(l,u,a,0),C(l,c,a,o),++E==b&&this.flush()}}},this.drawLineStrip=function(r){for(let e=2,t=r.length-1;e<t;e+=2)this.drawLine(r[e-2],r[e-1],r[e],r[e+1]);this.drawPoints(r.slice(2,-2))},this.drawLineLoop=function(r){var n=r[r.length-2],i=r[r.length-1];for(let e=0,t=r.length-1;e<t;e+=2){var a=r[e],o=r[e+1];this.drawLine(n,i,a,o),n=a,i=o}this.drawPoints(r)},this._drawImage=function(e,t,r,n,i,a,o,s,u,l=0,c=0,h=0,f=0){var d=L(_[e]),g=Math.cos(h),p=Math.sin(h),m=-l,v=-c,e=m+s,h=v+u,l=g*m-p*v+a,c=p*m+g*v+o,s=g*e-p*v+a,u=p*e+g*v+o,v=g*m-p*h+a,m=p*m+g*h+o,a=g*e-p*h+a,o=p*e+g*h+o;let y=A*t/d.width,x=A*r/d.height,w=y+A*n/d.width,T=x+A*i/d.height;1&f&&(d=y,y=w,w=d),2&f&&(f=x,x=T,T=f),C(l,c,y,x),C(s,u,w,x),C(v,m,y,T),C(v,m,y,T),C(s,u,w,x),C(a,o,w,T),++E==b&&this.flush()},this.drawImage=function(e,t=0,r=0,n=0,i=1,a=this.FLIP_NONE){var o=L(_[e]);i*=o.sc,this._drawImage(o.parent||e,o.x,o.y,o.width,o.height,t,r,o.width*i,o.height*i,o.cx*i,o.cy*i,n,a)},this.stretchImage=function(e,t,r,n,i){var a=L(_[e]);this._drawImage(a.parent||e,a.x,a.y,a.width,a.height,t,r,n,i)},this.drawSprite=function(e){"color"in e&&this.color(e.color);var t=e.x||0,r=e.y||0,n=e.rot||0,i=e.sc||1;this.drawImage(e.image,t,r,n,i,e.flip)},this.fillTriangle=function(e,t,r,n,i,a){L(I),C(e,t),C(r,n),C(i,a),C(e,t),C(e,t),C(e,t),++E==b&&this.flush()},this.fillTriangles=function(e){for(var t=0,r=Math.floor(e.length/6);t<r;++t)this.fillTriangle(e[t],e[t+1],e[t+2],e[t+3],e[t+4],e[t+5])},this.drawTiles=function(e,t,r,n=void 0,i=void 0,a=t){for(var o=L(_[e]),s=o.width,u=o.height,l=0;l<r;++l)for(var c=0;c<t;++c){var h=l*a+c;i&&this.color(i[h]);h=n?e+n[h]:e;this.drawImage(h,c*s,l*u)}},this.drawImages=function(e,t,r,n){for(var i=Math.floor(n.length/t),a=0!=(r&this.COMP_COLOR_RGBA),o=255,s=255,u=255,l=255,c=0;c<i;++c){var h=n.subarray(c*t,c*t+t),f=e,d=0;if(r&this.COMP_IMG_OFFSET&&(f+=h[d++]),f&&!(f>=_.length)){var g=h[d++],p=h[d++],m=r&this.COMP_ROT?h[d++]:0,v=r&this.COMP_SCALE?h[d++]:1;if(a){if(o=r&this.COMP_COLOR_R?h[d++]:o,s=r&this.COMP_COLOR_G?h[d++]:s,u=r&this.COMP_COLOR_B?h[d++]:u,(l=r&this.COMP_COLOR_A?h[d++]:l)<=0)continue;this.color(o,s,u,l)}this.drawImage(f,g,p,m,v)}}},this.flush=function(){c.uniform2f(v,i.width,i.height),c.uniformMatrix3fv(y,!1,s),c.uniform1i(x,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,l),c.bufferData(c.ARRAY_BUFFER,a,c.STREAM_DRAW),c.drawArrays(c.TRIANGLES,0,6*E),c.flush(),E=0,o=0},this._frameBegin=function(e,t,r){c.viewport(0,0,i.width,i.height),c.clearColor(e,t,r,1),c.clear(c.COLOR_BUFFER_BIT),c.enable(c.BLEND),R()},this._frameEnd=this.reset,f=c.createBuffer(),c.bindBuffer(c.ARRAY_BUFFER,f),f=e*t,c.vertexAttribPointer(d,2,c.FLOAT,!1,f,0*e),c.vertexAttribPointer(g,4,c.UNSIGNED_BYTE,!0,f,2*e),c.vertexAttribPointer(p,2,c.SHORT,!1,f,3*e);const I=_[this.createTexture(2,2,new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]))],M=this.createCircleTexture(32);this.setTextureCenter(M,.5,.5),_[M].sc=1/64,this.loadFont("bold 20px monospace"),l=I.texture,P(this,"ALIGN_LEFT",0),P(this,"ALIGN_CENTER",1),P(this,"ALIGN_RIGHT",2),P(this,"ALIGN_TOP",0),P(this,"ALIGN_MIDDLE",4),P(this,"ALIGN_BOTTOM",8),P(this,"FLIP_NONE",0),P(this,"ALIGN_LEFT_TOP",0),P(this,"ALIGN_CENTER_TOP",1),P(this,"ALIGN_RIGHT_TOP",2),P(this,"ALIGN_LEFT_MIDDLE",4),P(this,"ALIGN_CENTER_MIDDLE",5),P(this,"ALIGN_RIGHT_MIDDLE",6),P(this,"ALIGN_LEFT_BOTTOM",8),P(this,"ALIGN_CENTER_BOTTOM",9),P(this,"ALIGN_RIGHT_BOTTOM",10),P(this,"FLIP_X",1),P(this,"FLIP_Y",2),P(this,"FLIP_XY",3),P(this,"IMG_CIRCLE",M),P(this,"IMG_SQUARE",I),P(this,"BLEND_NONE",0),P(this,"BLEND_ALPHA",1),P(this,"BLEND_ADD",2),P(this,"BLEND_MOD",4),P(this,"BLEND_MUL",8),P(this,"COMP_IMG_OFFSET",1),P(this,"COMP_ROT",8),P(this,"COMP_SCALE",16),P(this,"COMP_COLOR_R",32),P(this,"COMP_COLOR_G",64),P(this,"COMP_COLOR_B",128),P(this,"COMP_COLOR_A",256),P(this,"COMP_COLOR_RGB",224),P(this,"COMP_COLOR_RGBA",480)}}(),arcajs.audio=function(){let h=new(window.AudioContext?AudioContext:webkitAudioContext);let s=[],u=[];for(let e=0;e<16;++e)u.push(null);let n=null,c=h.createGain();function l(){let e=0;for(;e<16;++e)if(null===u[e])return e;return 16}function f(e,t){if("noi"===e)return function(e=2093){if(null===n){var t=2*h.sampleRate;n=h.createBuffer(1,t,h.sampleRate),output=n.getChannelData(0);for(let e=0;e<t;e++)output[e]=2*Math.random()-1}let r=h.createBufferSource();return r.buffer=n,r.loop=!0,0<e&&(r.playbackRate.value=e/2093),r}(t);let r=h.createOscillator();switch(r.start||(r.start=r.noteOn),e){case"saw":r.type="sawtooth";break;case"sin":r.type="sine";break;case"squ":case"sqr":r.type="square";break;case"tri":r.type="triangle"}return r.frequency.value=t,r}function d(e,t,r){e.start||(e.start=e.noteOn);let n=h.createGain();n.gain.value=t,e.connect(n);let i=n;if(r){let e;h.createStereoPanner?(e=h.createStereoPanner(),e.pan.value=r):(e=h.createPanner(),e.panningModel="equalpower",e.setPosition(r,0,1-Math.abs(r))),i.connect(e),i=e}return i.connect(c),n}function y(e,t,r){if("number"==typeof e)return e;if("0"<=e[0]&&e[0]<="9")return parseFloat(e);let n;switch(e){case"B":case"H":n=2;break;case"C":n=3;break;case"D":n=5;break;case"E":n=7;break;case"F":n=8;break;case"G":n=10;break;case"-":return 0;default:n=0}"b"==t?--n:"#"==t&&++n,2<n&&--r;t=27.5*Math.pow(2,r),r=Math.pow(2,1/12);return t*Math.pow(r,n)}function a(e){function u(e,t,r,n){let i=1;e.charAt(t)in{"-":!0,"+":!0}&&("-"===e.charAt(t)&&(i=-1),++t);let a=NaN,o=!1,s=.1;for(;t<e.length;){var u=e.charAt(t);if("."!==u){if(!/\d/.test(u))break;Number.isNaN(a)&&(a=0),o?(a+=s*Number(u),s/=10):a=10*a+Number(u),++t}else{if(o)break;o=!0,++t}}return a*=i,Number.isNaN(a)?++t:(r[n]=a,--t),t}function l(e,t,r,n){for(":"===e.charAt(++t)&&++t;/\s/.test(e.charAt(t));)++t;return u(e,t,r,n)}let o=function(r){let n=[];for(let e=0,t=r.length;e<t;++e){var i=r.charAt(e);if(!/\s/.test(i))if("{"!=i){var a=[];if(e=function(r,n,i){for(var e=r.length;n<e;++n){let t=r.charAt(n);if(!/\s/.test(t)){let e=-1;if("0"<=t&&t<="9"||"."===t){var a={};if(n=u(r,n,a,"v"),e=a.v,++n>=r.length)return;t=r.charAt(n)}else{if(!(t in{"-":!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0}))return console.error("invalid note",t,"at pos",n);a=t;if(++n>=r.length)return;t=r.charAt(n);var o="#"==t||"b"==t?t:" ";if(" "!=o){if(++n>=r.length)return;t=r.charAt(n)}if("-"!=a&&!/\d/.test(t))return console.error("invalid octave",t,"at pos",n);var s=t.charCodeAt(0)-"0".charCodeAt(0);if("-"!=a){if(++n>=r.length)return;t=r.charAt(n)}e=y(a,o,s)}if("/"!=t&&"*"!=t)return console.error("invalid duration signifier at pos",n);o="/"==t,s={};n=l(r,n,s,"v"),"v"in s&&0<s.v&&(i.push(e),i.push(o?1/s.v:s.v));break}}return n}(r,e,a),2!==a.length)break;n.push(a)}else{a={};e=function(e,t,r){for(var n=e.length;t<n;++t){var i=e.charAt(t);if(!/\s/.test(i)){if("}"===i)break;switch(i){case"a":t=l(e,t,r,"attack");break;case"b":t=l(e,t,r,"beatLen"),"beatLen"in r&&(r.beatLen=240/r.beatLen);break;case"d":t=l(e,t,r,"decay");break;case"g":t=l(e,t,r,"gain");break;case"h":t=l(e,t,r,"hold");break;case"r":t=l(e,t,r,"release");break;case"s":t=l(e,t,r,"sustain");break;case"w":++t,":"===e.charAt(t)&&++t,e.substr(t,3)in{sin:!0,tri:!0,sqr:!0,saw:!0,noi:!0}&&(r.waveForm=e.substr(t,3)),t+=3}}}return t}(r,e+1,a),0!==Object.keys(a).length&&n.push(a)}}return n}(e),s=h.createGain();this.replay=function(e=1,t=0){let r={waveForm:"sqr",attack:0,hold:0,decay:0,sustain:1,release:0,gain:1,beatLen:240/72},n=0;s.gain.value=e,s.connect(c);for(let e=0;e<o.length;++e){var i=o[e];if(Array.isArray(i))n=function(t,e,r,n,i=0,a=0){let o=f(n.waveForm,e),s=h.createGain();var u,l,c;if(o.connect(s),i+=(u=o,l=s,c=n,e=r,n=h.currentTime+i,r=c.gain,e*=c.beatLen,u.start(n),0<c.attack?(l.gain.setValueAtTime(0,n),l.gain.linearRampToValueAtTime(r,n+c.attack)):l.gain.setValueAtTime(r,n),c.sustain<1&&(l.gain.setValueAtTime(r,n+c.attack+c.hold),l.gain.linearRampToValueAtTime(c.sustain*r,n+c.attack+c.hold+c.decay)),0<c.release?(l.gain.linearRampToValueAtTime(0,n+e+c.release),"frequency"in u&&u.frequency.setValueAtTime(0,n+e+c.release)):"frequency"in u&&u.frequency.setValueAtTime(0,n+e),e),a){let e=h.createStereoPanner();e.pan.value=a,s.connect(e),e.connect(t)}else s.connect(t);return i}(s,i[0],i[1],r,n,t);else if("object"==typeof i)for(var a in i)r[a]=i[a]}return n},this.stop=function(){s.disconnect()},this.volume=function(e){s.gain.value=e}}return c.gain.value=1,c.connect(h.destination),{resume:function(){"running"!==h.state&&h.resume()},suspend:function(){h.suspend()},load:function(r,n,i){if(Array.isArray(r)){let t=[];for(let e=0;e<r.length;++e)t.push(this.load(r[e],n,i));return t}var e={id:s.length+1,ready:!1,url:r,buffer:null,offset:0};return s.push(e),function(e,i,a){let t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=()=>{h.decodeAudioData(t.response,t=>{if(!t)return console.error("error decoding file data:",i);let r=s[i-1];r.buffer=t,r.ready=!0;var n=t.getChannelData(0);for(let e=0;e<n.length;++e)if(.002<n[e]||n[e]<-.002){r.offset=e/t.sampleRate;break}a&&a(r)},e=>{console.error("decodeAudioData error",i,e)})},t.onerror=()=>{console.error("loadSample: XHR error",e)},t.send()}(r,e.id,i),e.id},replay:function(r,n=1,i=0,a=0,o=0){if(!(0===(r=Array.isArray(r)?r[Math.floor(Math.random()*r.length)]:r)||r>s.length)){r=s[r-1];if(r.ready&&r.buffer){let e=l();if(16===e)return 4294967295;let t=h.createBufferSource();return 0!==a&&(t.playbackRate.value=Math.pow(2,a/12)),t.buffer=r.buffer,u[e]={src:t,gain:d(t,n,i)},t.start(h.currentTime+o,r.offset||0),t.addEventListener("ended",()=>{u[e]=null}),e}}},stop:function(e){if(void 0===e)for(let t=0;t<16;++t)if(null!==u[t]){let e=u[t].src;e.stop(),u[t]=null}let t=u[e];t&&(("src"in t?t.src:t).stop(),u[e]=null)},volume:function(t,r){if(void 0===t)return c.gain.value;if(void 0!==r){let e=u[t];e&&("gain"in e?e.gain.gain.value=r:e.volume(r))}else c.gain.value=t},fadeOut:function(e,t){let r=u[e];r&&"gain"in r&&(r.gain.gain.linearRampToValueAtTime(0,h.currentTime+t),r.src.stop(h.currentTime+t))},playing:function(e){if("running"!==h.state)return!1;if(void 0!==e)return!!u[e];for(let e=0;e<16;++e)if(null!==u[e])return!0;return!1},sound:function(e,t,r,n=1,i=0){let a=f(e.substr(0,3).toLowerCase(),this.note2freq(t)),o=l();if(16===o)return 4294967295;u[o]={src:a,gain:d(a,n,i)},a.addEventListener("ended",()=>{u[o]=null}),a.start(),a.stop(h.currentTime+r)},melody:function(e,t=1,r=0){let n=l();if(16===n)return 4294967295;let i=u[n]=new a(e);r=i.replay(t,r);setTimeout(()=>{u[n].stop(),u[n]=null},1e3*r)},uploadPCM:function(n,i=1,e=0){"object"==typeof n&&n.samples&&(i=n.channels||1,e=n.offset||0,n=n.samples);var t=h.createBuffer(i,n.length/i,h.sampleRate);for(let r=0;r<i;++r){var a=t.getChannelData(r);for(let e=0,t=n.length/i;e<t;++e)a[e]=n[e*i+r]}return s.push({id:s.length+1,ready:!0,url:"",buffer:t,offset:e}),s.length},release:function(e){if(!(0===e||e>s.length)){const t=s[e-1];t.ready=!1,t.buffer=null}},sampleRate:h.sampleRate,createSoundBuffer:function(){const T=audio.sampleRate,r=2*Math.PI;function t(e,t){return e%1<t?1:-1}function e(e,t){var r=t/2,n=e%1,e=1-r;return n<r?n/r:n<e?1-2*(n-r)/(1-t):(n-e)/r-1}function n(e,t){t=Math.ceil(T/2e4/t);return--n.counter<0&&(n.counter=t,n.amplPrev=n.amplitude,n.amplitude=2*Math.random()-1),n.amplitude*(1-n.counter/t)+n.amplPrev*(n.counter/t)}function i(e,t){t*=2e4;return--i.counter<0&&(i.counter=Math.ceil(Math.random()*T/t),i.amplitude=-i.amplitude),i.amplitude}var a;switch(n.counter=-1,n.amplitude=n.amplPrev=0,i.counter=-1,i.amplitude=1,(arguments=1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments)[0].slice(0,2)){case"si":a=function(e,t){return void 0===t||1<=t?Math.sin(r*e):(e=Math.sin(r*e),Math.sign(e)*Math.abs(e)**t)};break;case"sa":a=e;break;case"sq":a=t;break;case"bi":a=i;break;case"no":a=n;break;case"tr":a=e;break;default:throw"invalid wave form name "+JSON.stringify(arguments[0])}for(var o=0,s=3;s<arguments.length;s+=4)o+=arguments[s];for(var u,l,c,h=new Float32Array(Math.ceil(o*T)),f=0,d=0,s=1;s<arguments.length;s+=4){var g=y(arguments[s]),p=arguments[s+1]||0,m=arguments[s+2],v="number"==typeof arguments[s+3]?arguments[s+3]:function(e){switch(e){case t:case i:return.5;default:return 1}}(a);m&&(d=function(e,t,r,n,i,a,o,s,u,l,c){for(var h=s-o,f=a-i,d=l-u,g=T*c,p=1/T,m=0,v=Math.floor(r*T);m<g;++m,++v,0){var y=m/g,x=o+h*y,w=i+f*y;t[v]=Math.max(-1,Math.min(1,e(n,u+d*y)*x)),n+=w*p}return n}(a,h,f,d,u=void 0===u?g:u,g,l=void 0===l?p:l,p,c=void 0===c?v:c,v,m),f+=m),u=g,l=p,c=v}return h},mixToBuffer:function(e,t,r,n,i){"number"==typeof t&&(t=this.sampleBuffer(t));for(var a=Math.floor(e.length/2),o=t.length,s=n*(-.4*i+.6),u=n*(.4*i+.6),l=Math.round(r*audio.sampleRate),c=0;l<a&&c<o;++l,++c)e[2*l]+=t[c]*s,e[2*l+1]+=t[c]*u},clampBuffer:function(e,t,r){for(var n=0,i=e.length;n<i;++n)e[n]=Math.min(Math.max(e[n],t),r)},sampleBuffer:function(e){if(0<e&&e<=s.length)return s[e-1].buffer},note2freq:function(e){if("number"==typeof e)return e;var t=e.charAt(0);if("0"<=t&&t<="9")return parseFloat(e);if(!(t in{"-":!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0,H:!0}))return console.error("invalid note",t);var r=e.charAt(1),r="#"==r||"b"==r?r:" ";const n=e.charAt(" "!=r?2:1);return"-"==t||/\d/.test(n)?y(t,r,n.charCodeAt(0)-"0".charCodeAt(0)):console.error("invalid octave",n)},createSound:function(...e){return this.uploadPCM(this.createSoundBuffer(e))}}}();let app=arcajs.app=function(i="arcajs_canvas"){let a=[0,0,0],r={},o=null,s=null,u={},l=0,n={audio:arcajs.audio,intersects:arcajs.intersects},c=[],h=.1,f=0,t=!1,d=!1;"visible"in window.console||(window.console.visible=function(){});const e=document.getElementById(i);let g=new arcajs.Graphics(e);function p(){for(let r=0,e=c.length;r<e;++r){const n=c[r];if(n&&n.connected){let t=function(e){var t=c[e];if(!t||!t.connected)return{index:e,connected:!1};var r=navigator.getGamepads()[e];let n={index:e,connected:!0,buttons:[],axes:[]};for(let e=0;e<r.buttons.length;++e)n.buttons[e]=r.buttons[e].pressed;for(let e=0;e<r.axes.length;++e)n.axes[e]=r.axes[e];return n}(r);if(null!==n.state){for(let e=0;e<t.buttons.length;++e)t.buttons[e]!=n.state.buttons[e]&&v.emit("gamepad",{type:"button",index:r,button:e,value:t.buttons[e]?1:0});for(let e=0;e<t.axes.length;++e)Math.round(t.axes[e]/h)!=Math.round(n.state.axes[e]/h)&&(t.axes[e]<.5*h&&t.axes[e]>.5*-h&&(t.axes[e]=0),v.emit("gamepad",{type:"axis",index:r,axis:e,value:t.axes[e]}))}n.state=t}}}function m(e,t,r,n){if(!e.repeat){if("state"in m||(m.state={}),!(t in m.state)){const l=m.state[t]={axes:[],buttons:[]};if(r)for(var i=0;i<r.length;i+=2)l.axes.push(0);if(n)for(i=0;i<n.length;++i)l.buttons.push(!1);v.emit("gamepad",{index:t,type:"connect",axes:l.axes.length,buttons:l.buttons.length})}const l=m.state[t];var a="keydown"===e.type;if(a||"keyup"===e.type){if(r)for(i=0;i<r.length;++i)if(e.key===r[i]){var o=Math.floor(i/2),s=i%2?1:-1;if(a){if(l.axes[o]===s)return}else if(0===l.axes[o]||l.axes[o]!==s)return;return l.axes[o]=a?s:0,v.emit("gamepad",{index:t,type:"axis",axis:o,value:l.axes[o]})}if(n)for(i=0;i<n.length;++i){var u=n[i];if((e.key===u||"object"==typeof u&&e.key===u.key&&e.location==u.location)&&l.buttons[i]!=a)return l.buttons[i]=a,v.emit("gamepad",{index:t,type:"button",button:i,value:a?1:0})}}}}const v={version:"v0.20230422a",platform:"browser",width:window.innerWidth,height:window.innerHeight,pixelRatio:1,setBackground:function(e,t,r){Array.isArray(e)?(a[0]=e[0]/255,a[1]=e[1]/255,a[2]=e[2]/255):void 0===t?(a[0]=((4278190080&e)>>>24)/255,a[1]=((16711680&e)>>>16)/255,a[2]=((65280&e)>>>8)/255):(a[0]=e/255,a[1]=t/255,a[2]=r/255)},close:function(){1<history.length?history.back():("tv"===this.platform?window.open("","_self"):window).close()},on:function(e,t){if("object"==typeof e)return"load"in e&&this.on("load",e.load),"close"in e&&this.on("close",e.close),void(o=e);t?(r[e]=t,"gamepad"===e&&(s=t)):(delete r[e],"gamepad"===e&&(s=null))},emit:function(e,...t){e in r&&r[e](...t),"*"in r&&r["*"](e,...t)},emitAsGamepadEvent:m,getResource:function(r,n={}){if(Array.isArray(r)){let t=[];for(let e=0;e<r.length;++e)t.push(this.getResource(r[e],n));return t}var e=r.substr(r.lastIndexOf(".")+1).toLowerCase(),t=n.scale||1,i="svg"===e?r+"/"+t:r;if(i in u)return u[i];t=()=>{l<=0||0==--l&&setTimeout(()=>{this._run()},5)};let a=0;return"font"==n.type||"ttf"==e?a=g.loadFont(r,n,t):"png"==e||"jpg"==e||"svg"==e?a=g.loadTexture(r,n,t):"mp3"!=e&&"wav"!=e||(a=arcajs.audio.load(r,n,t)),a&&(++l,u[i]=a),a},createImageResource:function(...e){return g.createTexture(...e)},createCircleResource:function(e,t=[255,255,255,255],r=0,n=[255,255,255,255]){return g.createCircleTexture(e,t,r,n)},createPathResource:function(...e){return function(e,t,r,n=[255,255,255,255],i=0,a=[255,255,255,255]){let o=document.createElement("canvas");o.width=e,o.height=t;let s=o.getContext("2d");return s.lineWidth=i,s.fillStyle=n?"rgba("+n[0]+","+n[1]+","+n[2]+","+("number"==typeof n[3]?n[3]/255:1)+")":"transparent",s.strokeStyle=i?"rgba("+a[0]+","+a[1]+","+a[2]+","+("number"==typeof a[3]?a[3]/255:1)+")":"transparent",r=new Path2D(r),n&&s.fill(r),i&&s.stroke(r),r=new Uint8Array(s.getImageData(0,0,e,t).data.buffer),g.createTexture(e,t,r)}(...e)},createSVGResource:function(e,t){return t=t,(e=e).startsWith('<svg xmlns="http://www.w3.org/2000/svg"')||(e='<svg xmlns="http://www.w3.org/2000/svg"'+e.substr(4)),e=new Blob([e],{type:"image/svg+xml"}),g.loadTexture(URL.createObjectURL(e),t)},createTileResources:function(e,t,r=1,n=0,i){return g.createTileTextures(e,t,r,n,i)},createTileResource:function(e,t,r,n,i,a){return g.createTileTexture(e,t,r,n,i,a)},createImageFontResource:function(e,t){return g.createImageFontResource(e,t)},releaseResource:function(e,t){t.startsWith("image")?g.releaseTexture(e):t.startsWith("audio")&&audio.release(e)},setImageCenter:function(e,t,r){g.setTextureCenter(e,t,r)},queryImage:function(e){return g.queryTexture(e)},queryFont:function(e,t){return g.measureText(e,t)},setPointer:function(e){document.getElementById(i).style.cursor=e?"":"none"},httpGet:function(e,t){arcajs.http.get(e,null,t)},httpPost:function(e,t,r){arcajs.http.post(e,t,r)},createSpriteSet:function(...e){return arcajs.createSpriteSet(...e)},include:function(e,t){const r=document.createElement("script");r.type="text/javascript",r.src=e,r.async=!1,t&&r.addEventListener("load",t,!1),document.querySelector("head").appendChild(r)},require:function(e){return n[e]},exports:function(e,t){n[e]=t},resizable:function(e){},fullscreen:function(e){e?document.fullscreenEnabled&&!document.fullscreenElement?document.documentElement.requestFullscreen():document.webkitFullscreenEnabled&&!document.webkitFullscreenElement&&document.documentElement.webkitRequestFullscreen():document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()},vibrate:function(e){"vibrate"in navigator?navigator.vibrate(1e3*e):"mozVibrate"in navigator&&navigator.mozVibrate(1e3*e)},prompt:function(e,t,r){return Array.isArray(e)&&(e=e.join("\n")),window.prompt(e,t)},message:function(e,t){return Array.isArray(e)&&(e=e.join("\n")),t&&"button1"in t?window.confirm(e):window.alert(e)},hsl:function(e,t,r,n){function i(e,t,r){return r<0?r+=1:1<r&&--r,6*r<1?e+6*(t-e)*r:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}if(t<5e-6)return[r=Math.floor(255*r),r,r,n];if(isNaN(e))return[0,0,0,n];for(;360<=e;)e-=360;for(;e<0;)e+=360;t=r<.5?r*(1+t):r+t-t*r,r=2*r-t;return[Math.floor(255*i(r,t,e/360+1/3)),Math.floor(255*i(r,t,e/360)),Math.floor(255*i(r,t,e/360-1/3)),n]},transformArray:function(r,n){const i=[],a=arguments[arguments.length-1];for(let e=2,t=arguments.length-1;e<t;++e)i.push(arguments[e]);for(let e=0,t=r.length;e<t;e+=n)a(r.slice(e,e+n),r.subarray(e,e+n),...i)},_run:function(e=!1){t||(e&&(d=!0),!0===d&&!1===t&&0===l&&(v.emit("load"),t=!0),t&&setTimeout(()=>{requestAnimationFrame(x)},0))}},y=navigator.userAgent;(y.match(/AFT/)||y.match(/smart\-tv/i)||y.match(/smarttv/i))&&(v.platform="tv");const x=e=>{o&&function(){v.emit("leave");const r=o;["update","draw","resize","keyboard","pointer","gamepad","enter","leave","visibilitychange","custom"].forEach(function(t){t in r?v.on(t,function(...e){r[t](...e)}):v.on(t)}),v.emit("enter"),o=null}(),null!==s&&p();var t=(e*=.001)-f;f=e,v.emit("update",t,e);var r,n=document.getElementById(i);r=1,e=(t=n).clientWidth*r,r=t.clientHeight*r,t.width===e&&t.height===r||(t.width=e,t.height=r,v.emit("resize",t.clientWidth,t.clientHeight)),v.width=n.width,v.height=n.height,g._frameBegin(...a),v.emit("draw",g),g._frameEnd(),requestAnimationFrame(x)},w="tv"===v.platform?function(e){switch(e.key){case"MediaRewind":case"MediaFastForward":case"MediaPlayPause":case"ContextMenu":case"GoBack":e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}}:function(){};return document.body.addEventListener("touchmove",e=>{},{passive:!0}),window.addEventListener("unload",()=>{v.emit("close")}),window.addEventListener("keydown",e=>{w(e),e.ctrlKey&&"v"===e.key||("keyboard"in r||"textinput"in r)&&(v.emit("keyboard",e),function(e){if("textinput"in r)if(1==e.key.length){var t=e.key.charCodeAt(0);32<=t&&t<256&&v.emit("textinput",{type:"textinput",char:e.key})}else switch(e.key){case"Alt":case"AltGraph":case"CapsLock":case"Control":case"Shift":return;default:v.emit("textinput",{type:"textinput",key:e.key})}}(e),e.preventDefault())}),window.addEventListener("keyup",e=>{w(e),v.emit("keyboard",e)}),document.addEventListener("keypress",e=>{w(e)}),window.addEventListener("gamepadconnected",e=>{c[e.gamepad.index]={id:e.gamepad.id,connected:!0,state:null},v.emit("gamepad",{index:e.gamepad.index,name:e.gamepad.id,type:"connected",axes:e.gamepad.axes.length,buttons:e.gamepad.buttons.length})}),window.addEventListener("gamepaddisconnected",e=>{c[e.gamepad.index]={id:e.gamepad.id,connected:!1,state:null},v.emit("gamepad",{index:e.gamepad.index,name:e.gamepad.id,type:"disconnected"})}),e.addEventListener("dragover",e=>{e.preventDefault()}),e.addEventListener("drop",e=>{e.preventDefault(),e.dataTransfer.items?[...e.dataTransfer.items].forEach(e=>{if("file"===e.kind){const t=new FileReader;t.addEventListener("load",()=>{v.emit("textinsert",{type:"drop",data:t.result})}),t.readAsText(e.getAsFile())}else"string"===e.kind&&e.getAsString(e=>{e&&v.emit("textinsert",{type:"drop",data:e})})}):e.dataTransfer.files?[...e.dataTransfer.files].forEach(e=>{const t=new FileReader;t.addEventListener("load",()=>{v.emit("textinsert",{type:"drop",data:t.result})}),t.readAsText(e)}):(e=e.dataTransfer.getData("text/plain"))&&v.emit("textinsert",{type:"drop",data:e})}),window.addEventListener("paste",e=>{e.preventDefault();e=(e.clipboardData||window.clipboardData).getData("text");"string"==typeof e&&e.length&&v.emit("textinsert",{type:"paste",data:e})}),arcajs.infra.addPointerEventListener(e,e=>{v.emit("pointer",e)}),!("hidden"in document)&&"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",()=>{v.emit("visibilitychange",{visible:!document.webkitHidden})}):document.addEventListener("visibilitychange",()=>{v.emit("visibilitychange",{visible:!document.hidden})}),document.addEventListener("pause",()=>{v.emit("visibilitychange",{visible:!1})},!1),document.addEventListener("resume",()=>{v.emit("visibilitychange",{visible:!0})},!1),setTimeout(()=>{v.emit("resize",{width:e.width,height:e.height})},0),v}();
