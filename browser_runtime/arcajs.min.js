arcajs={},arcajs.infra={addPointerEventListener:function(t,n){var e=r=>{for(let t=0,e=this.normalizeEvents(r);t<e.length;++t)n(e[t]);return!0};void 0!==t.style.touchAction&&(t.style.touchAction="none"),t.oncontextmenu=t=>!1,this.normalizeEvents.pointerDown=[],window.PointerEvent?t.onpointerdown=t.onpointermove=t.onpointerup=t.onpointerout=t.onpointerenter=t.onpointerleave=e:t.ontouchstart=t.ontouchend=t.ontouchmove=e},normalizeEvents:function(i){let o=this.normalizeEvents.pointerDown;function l(r){for(let t=0,e=o.length;t!=e;++t)if(o[t]==r)return t}function h(t){for(let t=0;;++t)if(void 0===o[t])return t}let s=[];if(window.PointerEvent){let t,e=null;if(i.type in{pointerdown:!0,pointerenter:!0}){if("mouse"!==i.pointerType)t=h(i.pointerId);else switch(i.button){case 1:t=2;break;case 2:t=1;break;default:t=i.button}0<=t&&(e="start",o[t]=i.pointerId)}else if(i.type in{pointerup:!0,pointerout:!0,pointerleave:!0}){if(t=l(i.pointerId),void 0===t)return!1;e="end",delete o[t]}else"pointermove"==i.type&&(t=l(i.pointerId),void 0!==t?e="move":"mouse"==i.pointerType&&(e="hover"));e&&s.push({type:e,target:i.target,id:t||0,pointerType:i.pointerType,pageX:i.pageX,pageY:i.pageY,clientX:i.clientX,clientY:i.clientY,x:i.offsetX,y:i.offsetY,timeStamp:Math.round(i.timeStamp)})}else if(i.type in{touchstart:!0,touchmove:!0,touchend:!0,touchcancel:!0,touchleave:!0}){i.preventDefault();let t=i.target,n=0,a=0;for(;t&&void 0!==t.offsetLeft;)n+=t.offsetLeft,a+=t.offsetTop,t=t.offsetParent;for(let r=0;r<i.changedTouches.length;++r){var d=i.changedTouches[r];let t,e=i.type.substr(5);if("start"==e)t=h(d.identifier),o[t]=d.identifier;else{if(t=l(d.identifier),void 0===t)continue;"cancel"!=e&&"leave"!=e||(e="end"),"end"==e&&delete o[t]}s.push({type:e,id:t,pointerType:"touch",pageX:d.pageX,pageY:d.pageY,clientX:d.clientX,clientY:d.clientY,x:d.clientX-n,y:d.clientY-a,timeStamp:Math.round(i.timeStamp)})}}return!!s.length&&s}},arcajs.http={encodeURI:function(t){var e,r="";for(e in t){r.length&&(r+="&");var n=t[e];"object"==typeof n&&(n=JSON.stringify(n)),r+=e+"="+encodeURIComponent(n)}return r},request:function(t,n,e,a){const i=(r=(r=n).toLowerCase()).endsWith(".png")||r.endsWith(".jpg")?"image":r.endsWith(".wav")||r.endsWith(".mp3")?"audio":r.endsWith(".ttf")?"font":"";var r;const o=new XMLHttpRequest;try{o.open(t,n,!0),this.timeout&&(o.timeout=this.timeout),e&&"POST"==t?o.setRequestHeader("Content-type","application/x-www-form-urlencoded"):"GET"==t&&i&&(o.responseType="blob"),a&&(o.onload=o.onerror=o.ontimeout=function(t){var e=void 0===o.status?-1:1223==o.status?204:o.status,r=(r=o).contentType||("getResponseHeader"in r?r.getResponseHeader("Content-Type"):"")||"",r=-1==o.status||204==o.status?null:"application/json"==r?JSON.parse(o.responseText):i?o.response:o.responseText;if("error"==t.type?console.error(n,t):"timeout"==t.type&&(e=408),r===o.response)return function(t,h,s,d){if("image"===h){const n=document.createElement("img");n.src=URL.createObjectURL(t),n.onload=()=>{URL.revokeObjectURL(n.src);let t=document.createElement("canvas");t.width=n.width,t.height=n.height;let e=t.getContext("2d");e.drawImage(n,0,0,t.width,t.height);var r=new Uint8Array(e.getImageData(0,0,t.width,t.height).data.buffer);d({width:n.width,height:n.height,depth:4,data:r,mediaType:h},s)}}else{var e;"audio"===h?((e=new FileReader).onload=function(){const t=new AudioContext;t.decodeAudioData(e.result,t=>{var e=t.numberOfChannels,r=t.getChannelData(0),n=r.length;const a=1==e?r:new Float32Array(e*n);if(1<e){const l=[r];for(var i=1;i<e;++i)l.push(t.getChannelData(i));for(i=0;i<n;++i)for(var o=0;o<e;++o)a[i*e+o]=l[o][i]}d({samples:a,channels:e,offset:0,mediaType:h},s)})},e.readAsArrayBuffer(t)):console.error("readBinaryData",h,"not yet implemented")}}(r,i,e,a);a(r,e)}),o.send(e&&"POST"==t?this.encodeURI(e):null)}catch(t){return console&&console.error(t),a&&a(t,-2),!1}return o},get:function(t,e,r){return e&&(t+="?"+this.encodeURI(e)),this.request("GET",t,null,r)},post:function(t,e,r){return this.request("POST",t,e,r)},timeout:32e3},arcajs.intersects={transform:function(t,e,r,n=0){for(var a=Math.cos(n),i=Math.sin(n),o=0,l=t.length;o<l;o+=2){var h=t[o],s=t[o+1];t[o]=h*a-s*i+e,t[o+1]=h*i+s*a+r}},transformInv:function(t,e,r,n=0){for(var a=Math.cos(-n),i=Math.sin(-n),o=0,l=t.length;o<l;o+=2){var h=t[o]-e,s=t[o+1]-r;t[o]=h*a-s*i,t[o+1]=h*i+s*a}},pointCircle:function(t,e,r,n,a){t=r-t,e=n-e;return t*t+e*e<a*a},pointAlignedRect:function(t,e,r,n,a,i){return a<t||t<r||i<e||e<n?0:1},pointPolygon:function(t,e,r){if(r.length<6)return!1;for(var n=0,a=0,i=0;i<r.length;i+=2){var o=r[i],l=r[i+1];if(t==o&&e==l)return!0;var h=r[(i+2)%r.length],o=(t-o)*(r[(i+3)%r.length]-l)-(e-l)*(h-o);if(0<o?n++:o<0&&a++,0<n&&0<a)return!1}return!0},circleCircle:function(t,e,r,n,a,i){t=n-t,e=a-e,i=r+i;return t*t+e*e<i*i},circleAlignedRect:function(t,e,r,n,a,i,o){if(t<n-r||i+r<=t||e<a-r||o+r<=e)return!1;if(t<n){if(e<a)return(l=n-t)*l+(h=a-e)*h<r*r;if(o<e)return(l=n-t)*l+(h=e-o)*h<r*r}else if(i<t){var l,h;if(e<a)return(l=t-i)*l+(h=a-e)*h<r*r;if(o<e)return(l=t-i)*l+(h=e-o)*h<r*r}return!0},circleTriangle:function(t,e,r,n,a,i,o,l,h){var s=r*r,d=t-n,u=e-a,c=d*d+u*u-s;if(c<=0)return!0;var p=t-i,f=e-o,m=p*p+f*f-s;if(m<=0)return!0;var v=t-l,r=e-h,t=v*v+r*r-s;if(t<=0)return!0;e=i-n,s=o-a,i=l-i,o=h-o,l=n-l,h=a-h;if(e*u<=s*d){if(i*f<=o*p&&l*r<=h*v)return!0}else if(o*p<i*f&&h*v<l*r)return!0;u=d*e+u*s;if(0<u){var g=e*e+s*s;if(u<g&&c*g<=u*u)return!0}if(0<(u=p*i+f*o)){g=i*i+o*o;if(u<g&&m*g<=u*u)return!0}if(0<(u=v*l+r*h)){g=l*l+h*h;if(u<g&&t*g<=u*u)return!0}return!1},circlePolygon:function(t,e,r,n){if(n.length<6)return!1;for(var a=r*r,i=0,o=n.length;i<o;i+=2){var l=n[i]-t,h=n[i+1]-e;if(l*l+h*h<a)return!0}if(this.pointPolygon(t,e,n))return!0;for(i=0,o=n.length;i<o;i+=2){var s=n[i],d=n[i+1],u=n[(i+2)%n.length]-s,c=n[(i+3)%n.length]-d,p=t-s,s=e-d,d=(u*p+c*s)/(u*u+c*c);if(!(d<0||1<d)){u=p-u*d,d=s-c*d;if(u*u+d*d<a)return!0}}return!1},circleTriangles:function(t,e,r,n,a=0,i=0,o=0){var l=[t,e];this.transformInv(l,a,i,o);for(var h=0,s=Math.floor(n.length/6);h<s;++h)if(this.circleTriangle(l[0],l[1],r,n[6*h],n[6*h+1],n[6*h+2],n[6*h+3],n[6*h+4],n[6*h+5]))return!0;return!1},alignedRectAlignedRect:function(t,e,r,n,a,i,o,l){return!(r<a||o<t)&&!(n<i||l<e)},triangleTriangle:function(t,e,r,n,a,i,o,l,h,s,d,u){function c(t,e,r,n,a,i,o,l,h,s){return!((n-=e)*(a-t)<=(r-=t)*(i-e))&&(!(n*(o-t)<=r*(l-e))&&r*(s-e)<n*(h-t))}return!c(t,e,r,n,o,l,h,s,d,u)&&(!c(r,n,a,i,o,l,h,s,d,u)&&(!c(a,i,t,e,o,l,h,s,d,u)&&(!c(o,l,h,s,t,e,r,n,a,i)&&(!c(h,s,d,u,t,e,r,n,a,i)&&!c(d,u,o,l,t,e,r,n,a,i)))))},polygonPolygon:function(t,e){for(var r,n,a,i,o=[t,e],l=0;l<o.length;l++)for(var h=o[l],s=0;s<h.length;s+=2){for(var d=(s+2)%h.length,u=h[s],c=h[s+1],p=h[d],f=h[1+d]-c,m=u-p,v=r=void 0,g=0;g<t.length;g+=2)n=f*t[g]+m*t[g+1],(void 0===v||n<v)&&(v=n),(void 0===r||r<n)&&(r=n);for(a=i=void 0,g=0;g<e.length;g+=2)n=f*e[g]+m*e[g+1],(void 0===a||n<a)&&(a=n),(void 0===i||i<n)&&(i=n);if(r<a||i<v)return!1}return!0},polygonTriangles:function(t,e,r,n,a,i=0,o=0,l=0){let h=t;(e||r||n)&&(h=t.slice(0),this.transform(h,e,r,n));for(var s=0,d=Math.floor(a.length/6);s<d;++s){var u=a.slice(6*s,6*s+6);if((i||o||l)&&this.transform(u,i,o,l),this.polygonPolygon(h,u))return!0}return!1},trianglesTriangles:function(t,e,r,n,a,i=0,o=0,l=0){for(var h=0,s=Math.floor(t.length/6);h<s;++h){var d=t.slice(6*h,6*h+6);(e||r||n)&&this.transform(d,e,r,n);for(var u=0,c=Math.floor(a.length/6);u<c;++u){var p=a.slice(6*u,6*u+6);if((i||o||l)&&this.transform(p,i,o,l),this.triangleTriangle(...d,...p))return!0}}return!1},spritesCoarse:function(t,e){var r=this;if(0<=t.radius&&0<=e.radius)return r.circleCircle(t.x,t.y,t.radius,e.x,e.y,e.radius);if(0<=t.radius){if(!e.rot){var n=e.x-e.cx*e.w||0,a=e.y-e.cy*e.h||0;return r.circleAlignedRect(t.x,t.y,t.radius,n,a,n+e.w,a+e.h)}var i=[t.x,t.y];const u=-e.cx*e.w||0,c=-e.cy*e.h||0;n=[u,c,u,c+e.h,u+e.w,c+e.h,u+e.w,c];return r.transformInv(i,e.x,e.y,e.rot),r.circlePolygon(i[0],i[1],t.radius,n)}if(0<=e.radius){if(!t.rot){var o=t.x-t.cx*t.w||0,l=t.y-t.cy*t.h||0;return r.circleAlignedRect(e.x,e.y,e.radius,o,l,o+t.w,l+t.h)}var h=[e.x,e.y];const u=-t.cx*t.w||0,c=-t.cy*t.h||0;var s=[u,c,u,c+t.h,u+t.w,c+t.h,u+t.w,c];return r.transformInv(h,t.x,t.y,t.rot),r.circlePolygon(h[0],h[1],e.radius,s)}if(!t.rot&&!e.rot){var a=t.x-t.cx*t.w||0,i=t.y-t.cy*t.h||0,n=a+t.w,o=i+t.h,l=e.x-e.cx*e.w||0,h=e.y-e.cy*e.h||0,s=l+e.w,d=h+e.h;return r.alignedRectAlignedRect(a,i,n,o,l,h,s,d)}let u=-t.cx*t.w||0,c=-t.cy*t.h||0;d=[u,c,u,c+t.h,u+t.w,c+t.h,u+t.w,c];r.transform(d,t.x,t.y,t.rot),u=-e.cx*e.w||0,c=-e.cy*e.h||0;t=[u,c,u,c+e.h,u+e.w,c+e.h,u+e.w,c];return r.transform(t,e.x,e.y,e.rot),r.polygonPolygon(d,t)},sprites:function(t,e){const n=this;var r,a,i,o=n.spritesCoarse(t,e);if(!o||!t.shape&&!e.shape&&!t.triangles&&!e.triangles)return o;if(t.shape&&e.shape){var l=t.shape,h=e.shape;return(t.x||t.y||t.rot)&&(l=new Float32Array(l),n.transform(l,t.x,t.y,t.rot)),(e.x||e.y||e.rot)&&(h=new Float32Array(h),n.transform(h,e.x,e.y,e.rot)),n.polygonPolygon(l,h)}if(t.triangles&&e.triangles)return n.trianglesTriangles(t.triangles,t.x,t.y,t.rot,e.triangles,e.x,e.y,e.rot);function s(t){var e=-t.cx*t.w||0,r=-t.cy*t.h||0,r=[e,r,e,r+t.h,e+t.w,r+t.h,e+t.w,r];return(t.x||t.y||t.rot)&&n.transform(r,t.x,t.y,t.rot),r}if(l=t.shape?(a=t.shape,r=t,e):(a=e.shape,r=e,t),a){if(l.triangles)return n.polygonTriangles(r.shape,r.x,r.y,r.rot,l.triangles,l.x,l.y,l.rot);if(0<=l.radius){h=[l.x,l.y];return n.transformInv(h,r.x,r.y,r.rot),n.circlePolygon(h[0],h[1],l.radius,a)}const d=s(l);return(r.x||r.y||r.rot)&&(a=new Float32Array(a),n.transform(a,r.x,r.y,r.rot)),n.polygonPolygon(d,a)}if(0<=(t=t.triangles?(i=t,e):(i=e,t)).radius)return n.circleTriangles(t.x,t.y,t.radius,i.triangles,i.x,i.y,i.rot);const d=s(t);return n.polygonTriangles(d,0,0,0,i.triangles,i.x,i.y,i.rot)}};"use strict";arcajs.Graphics=function(){let O=new function(){var t=new Int8Array(4);let a=new Uint32Array(t.buffer,0,1),i=new Float32Array(t.buffer,0,1),r=new Int16Array(t.buffer,0,2);this.rgba=function(t,e,r,n=255){return a[0]=4278190079&(n<<24|r<<16|e<<8|t),i[0]},this.uint32=function(t){return a[0]=4278190079&t,i[0]},this.int14=function(t,e=0){return r[0]=t,r[1]=e,i[0]}};function P(t,e,r){Object.defineProperty(t,e,{value:r,writable:!1,enumerable:!0,configurable:!0})}function S(t,e,r){e=t.createShader(e);if(t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;console.error(t.getShaderInfoLog(e)),t.deleteShader(e)}return function(a,b=500){const t=4,e=4;var r=6*e;let i=new Float32Array(b*r),E=0,o=0,l=new Float32Array([1,0,0,0,1,0,0,0,1]),u=[new Float32Array([0,0,0,1,O.rgba(255,255,255),1])];function h(t,e){e[0]=Math.cos(t[2])*t[3],e[3]=-Math.sin(t[2])*t[3],e[6]=t[0],e[1]=-e[3],e[4]=e[0],e[7]=t[1]}let n=1;const A=16383;let v=[],k=[],s=null;const d=a.getContext("webgl")||a.getContext("experimental-webgl");var c,r=function(t,e,r){var n=S(t,t.VERTEX_SHADER,e),e=S(t,t.FRAGMENT_SHADER,r),r=t.createProgram();if(t.attachShader(r,n),t.attachShader(r,e),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS))return r;console.error(t.getProgramInfoLog(r)),t.deleteProgram(r)}(d,`
// input from vertex buffer:
attribute vec2 a_position;
attribute vec4 a_color;
attribute vec2 a_texCoord;
// output to fragment shader:
varying vec4 vtxColor;
varying vec2 texCoord;
// context shared across all vertices in this batch:
uniform vec2 u_resolution;
uniform mat3 u_matrix;

void main() {
	vec2 position = (u_matrix * vec3(a_position, 1)).xy;
	// convert the rectangle from pixels to 0.0 to 1.0
	vec2 zeroToOne = position / u_resolution;

	// convert from 0->1 to 0->2
	vec2 zeroToTwo = zeroToOne * 2.0;

	// convert from 0->2 to -1->+1 (clipspace)
	vec2 clipSpace = zeroToTwo - 1.0;

	gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
	vtxColor = a_color;
	texCoord = a_texCoord / vec2(16383.0,16383.0);
}`,`
precision mediump float;

uniform sampler2D u_texUnit0;

varying vec4 vtxColor;
varying vec2 texCoord;

void main() {
	vec4 texColor = texture2D(u_texUnit0, texCoord);
	gl_FragColor = vtxColor * texColor;
}`);const p=d.getAttribLocation(r,"a_position");d.enableVertexAttribArray(p);const f=d.getAttribLocation(r,"a_color");d.enableVertexAttribArray(f);const m=d.getAttribLocation(r,"a_texCoord");d.enableVertexAttribArray(m);let g=d.getUniformLocation(r,"u_resolution"),y=d.getUniformLocation(r,"u_matrix"),w=d.getUniformLocation(r,"u_texUnit0");function x(e){var r=A/e.width,n=A/e.height;let a=[];for(let t=0;t<e.glyphs.length;++t){var i=e.glyphs[t],o=i.x*r,l=i.y*n;a.push({xoff:i.xoff,yoff:i.yoff,w:i.w,h:i.h,tx1:o,ty1:l,tx2:o+i.w*r,ty2:l+i.h*n})}return a}function T(t){var e="filtering"in t?t.filtering:1,r="repeat"in t&&t.repeat,t=1<e?d.LINEAR_MIPMAP_LINEAR:1==e?d.LINEAR:d.NEAREST;d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,r?d.REPEAT:d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,r?d.REPEAT:d.CLAMP_TO_EDGE),1<e&&d.generateMipmap(d.TEXTURE_2D)}function R(){switch(n){case 0:d.blendFunc(d.ONE,d.ZERO);break;case 1:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case 2:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE,d.ZERO,d.ONE);break;case 4:d.blendFuncSeparate(d.DST_COLOR,d.ZERO,d.ZERO,d.ONE);break;case 8:d.blendFuncSeparate(d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA,d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA)}}d.useProgram(r),this.loadFont=function(n,a={},i){if("ttf"==n.substr(n.lastIndexOf(".")+1).toLowerCase()){let e=n.substr(0,n.indexOf("."));e=e.toLowerCase().split("-").map(t=>t.charAt(0).toUpperCase()+t.substring(1)).join(" ");let r=v.length,t=new FontFace(e,"url("+n+")");return t.load().then(t=>{document.fonts.add(t),this.loadFont(a.size+"px "+e,{fontId:r},i)}).catch(t=>{console.error("loading font resource",n,"failed:",t)}),v.push({texture:null,glyphs:null,size:a.size,width:0,height:0,ready:!1}),r}var t=function(t){let e=document.createElement("canvas");e.width=1024,e.height=1024;let r=e.getContext("2d");r.font=t,r.textBaseline="top";let n=[],a=0,i=0,o=0;for(let e=32;e<256;++e){var l=String.fromCharCode(e),l=r.measureText(l);let t={w:Math.ceil(l.width),h:Math.ceil(l.actualBoundingBoxAscent+l.actualBoundingBoxDescent)+4,xoff:0,yoff:Math.floor(-l.actualBoundingBoxAscent)-1};1024<a+t.w&&(i+=o+2,o=a=0);l=t.h+t.yoff;l>o&&(o=l),t.x=a,t.y=i+t.yoff,n.push(t),a+=t.w+1}e.height=i+o,r.fillStyle="white",r.font=t,r.textBaseline="top",a=0,i=0,o=0;for(let t=32;t<256;++t){var h=String.fromCharCode(t),s=n[t-32];1024<a+s.w&&(i+=o+2,o=a=0);var d=s.h+s.yoff;d>o&&(o=d),r.fillText(h,a+.5,i+.5),a+=s.w+1}return{data:r.getImageData(0,0,e.width,e.height).data,width:e.width,height:e.height,glyphs:n}}(n),e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,t.width,t.height,0,d.RGBA,d.UNSIGNED_BYTE,new Uint8Array(t.data.buffer)),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE);var r="fontId"in a?a.fontId:v.length;return v[r]={texture:e,glyphs:x(t),width:t.width,height:t.height,ready:!0},i&&i(),r},this.loadTexture=function(t,n={},e){let a={texture:d.createTexture(),ready:!1,x:0,y:0,width:1,height:1,cx:0,cy:0,sc:1};d.bindTexture(d.TEXTURE_2D,a.texture),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,1,1,0,d.RGBA,d.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var r=()=>{if(d.bindTexture(d.TEXTURE_2D,a.texture),"scale"in n){let t=document.createElement("canvas");t.width=Math.ceil(i.width*n.scale),t.height=Math.ceil(i.height*n.scale);let e=t.getContext("2d");e.drawImage(i,0,0,t.width,t.height);var r=new Uint8Array(e.getImageData(0,0,t.width,t.height).data.buffer);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,t.width,t.height,0,d.RGBA,d.UNSIGNED_BYTE,r),a.width=t.width,a.height=t.height}else d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,i),a.width=i.width,a.height=i.height;("centerX"in n||"centerY"in n)&&(a.cx=n.centerX||0,a.cy=n.centerY||0),a.cx&&(a.cx*=a.width),a.cy&&(a.cy*=a.height),T(n),a.ready=!0,delete a.img,e&&e(a)};let i=a.img=new Image;return i.src=t,i.complete?setTimeout(r,0):i.addEventListener("load",r),k.push(a),k.length-1},this.createTexture=function(t,e,r,n={}){var a;"object"==typeof t&&(t=(a=t).width,e=a.height,r=a.data);let i={texture:d.createTexture(),x:0,y:0,width:t,height:e,cx:0,cy:0,sc:1,ready:!0};return d.bindTexture(d.TEXTURE_2D,i.texture),r=Array.isArray(r)?new Uint8Array(r):new Uint8Array(r.buffer),d.texImage2D(d.TEXTURE_2D,0,d.RGBA,t,e,0,d.RGBA,d.UNSIGNED_BYTE,r),("centerX"in n||"centerY"in n)&&(i.cx=n.centerX*t,i.cy=n.centerY*e),T(n),k.push(i),k.length-1},this.createCircleTexture=function(t,e=[255,255,255,255],r=0,n=[0,0,0,0]){let a=document.createElement("canvas");a.width=a.height=Math.ceil(2*t+r);let i=a.getContext("2d");i.lineWidth=r,i.fillStyle=e?"rgba("+e[0]+","+e[1]+","+e[2]+","+("number"==typeof e[3]?e[3]/255:1)+")":"transparent",i.strokeStyle=r?"rgba("+n[0]+","+n[1]+","+n[2]+","+("number"==typeof n[3]?n[3]/255:1)+")":"transparent",i.beginPath(),i.arc(t+r/2,t+r/2,t,0,2*Math.PI,!0),i.closePath(),e&&i.fill(),r&&i.stroke();r=new Uint8Array(i.getImageData(0,0,a.width,a.height).data.buffer),r=this.createTexture(a.width,a.height,r);return this.setTextureCenter(r,.5,.5),r},this.createTileTexture=function(r,n,a,i,o,l){const h=k[r];if(!h)return console.error("createTileTexture() invalid parent id",r);const s=k.length;k.push({});var t=()=>{i*=h.width,o*=h.height;var t=l&&"centerX"in l?l.centerX:h.cx/h.width,e=l&&"centerY"in l?l.centerY:h.cy/h.height;k[s]={texture:h.texture,x:h.width*n,y:h.height*a,width:i,height:o,cx:i*t,cy:o*e,sc:h.sc,ready:h.ready,parent:h.parent||r}};return h.ready?t():h.img&&h.img.addEventListener("load",t),s},this.createTileTextures=function(l,h,s,d,t){"string"==typeof l&&(l=this.loadTexture(l,t));const u=k[l];if(!u)return console.error("createTileTextures() invalid parent id",l);const e=k.length;for(let t=0,e=h*s;t<e;++t)k.push({parent:u.parent||l,ready:u.ready});t=()=>{var r=u.width/h,n=r-2*d,a=u.height/s,i=a-2*d;let o=e;for(let e=0;e<s;++e)for(let t=0;t<h;++t)k[o++]={texture:u.texture,x:r*t+d,y:a*e+d,width:n,height:i,cx:u.cx/h,cy:u.cy/s,sc:u.sc,ready:u.ready,parent:u.parent||l}};return u.ready?t():u.img&&u.img.addEventListener("load",t),e},this.releaseTexture=function(t){const e=k[t];e&&(e.texture&&(d.deleteTexture(e.texture),e.texture=0),e.w=e.h=0,e.ready=!1)},this.createImageFontResource=function(n,t){"string"==typeof n?n=this.loadTexture(n,t):0===n&&(n=this.loadTexture(URL.createObjectURL(new Blob([`<svg xmlns="http://www.w3.org/2000/svg"
	width='192'
	height='256'
	version='1.1'>
   <g style='fill:none;stroke:#ffffff;stroke-width:2;stroke-linecap:butt;stroke-linejoin:miter' >
	 <circle style='fill:#ffffff' cx='176' cy='16' r='15'/>
	 <path d='m 74,80 v 9 l 4,4 4,-4 v -9' />
	 <path d='m 62,80 v 11 l 2,2 h 4 l 2,-2 V 80' />
	 <path style='stroke-linejoin:round' d='m 86,80 v 13 l 4,-4 4,4 V 80' />
	 <path d='m 46,84 v -1 l -2,-2 h -4 l -2,2 v 2 l 2,2 h 4 l 2,2 v 2 l -2,2 h -4 l -2,-2 v -1' />
	 <path d='m 98,80 v 2 l 4,4 v 2 l 4,4 v 2 m -8,0 v -2 l 4,-4 v -2 l 4,-4 v -2' />
	 <path d='m 114,89 v 5 m -4,-14 v 5 l 4,4 4,-4 v -5' />
	 <path d='m 162,217 v 5 m -4,-13 v 4 l 4,4 4,-4 v -4' />
	 <path d='m 121,81 h 9 v 2 l -8,8 v 2 h 9' />
	 <path d='m 141,81 h -5 v 12 h 5' />
	 <path style='stroke-linecap:round' d='m 146,83 9,9' />
	 <path d='m 26,96 v 13 h 6 l 2,-2 v -4 l -2,-2 h -6' />
	 <path d='m 46,103 v -1 l -1,-1 h -5 l -2,2 v 4 l 2,2 h 5 l 1,-1 v -1' />
	 <path d='m 94,231 v -1 l -1,-1 h -5 l -2,2 v 3 l 2,2 h 5 l 1,-1 v -1' />
	 <path d='m 58,101 h -6 l -2,2 v 4 l 2,2 h 6 V 96' />
	 <path d='m 62,105 h 8 v -2 l -2,-2 h -4 l -2,2 v 4 l 2,2 h 6' />
	 <path d='m 98,233 h 8 v -2 l -2,-2 h -4 l -2,2 v 4 l 2,2 h 6' />
	 <path d='m 110,233 h 8 v -2 l -2,-2 h -4 l -2,2 v 4 l 2,2 h 6'  />
	 <path d='m 80,102 h -7 m 9,-5 h -4 l -2,2 v 11' />
	 <path d='m 86,111 h 6 l 2,-2 v -8 h -6 l -2,2 v 2 l 2,2 h 6' />
	 <path d='m 98,101 h 5 l 2,2 v 7 M 98,96 v 14' />
	 <path d='m 114,97 v 2 m 0,1 v 10' />
	 <path d='m 128,97 v 2 m -5,10 v 1 l 1,1 h 3 l 1,-1 v -10' />
	 <path d='m 135,96 v 14' />
	 <path style='stroke-linecap:round' d='m 141,100 -5,5' />
	 <path style='stroke-linecap:round' d='m 141,109 -4,-4' />
	 <path d='m 149,96 v 12 l 1,1 h 3' />
	 <path d='m 162,101 v 9 m -4,0 v -9 h 7 l 1,1 v 8' />
	 <path d='M 2,94 V 81 h 6 l 2,2 v 3 L 8,88 H 2' />
	 <path style='stroke-linecap:round' d='m 19,90 3,3 m -6,-12 -2,2 v 8 l 2,2 h 3 l 3,-3 v -7 l -2,-2 z' />
	 <path d='M 26,94 V 81 h 6 l 2,2 v 3 l -2,2 h -6' />
	 <path style='stroke-linecap:round' d='M 34,93 29,88' />
	 <path d='m 2,128 v -11 h 6 l 2,2 v 3 l -2,2 H 2' />
	 <path d='m 22,128 v -11 h -6 l -2,2 v 3 l 2,2 h 6' />
	 <path d='m 27,126 v -9 h 5 l 1,1 v 1' />
	 <path d='m 37,125 h 6 l 1,-1 v -2 l -1,-1 h -4 l -1,-1 v -2 l 1,-1 h 6' />
	 <path d='m 49,117 h 8 m -5,-4 v 11 l 1,1 h 4' />
	 <path d='m 62,116 v 7 l 2,2 h 4 l 2,-2 v -7' />
	 <path d='m 111,244 v 7 l 2,2 h 4 l 2,-2 v -7' />
	 <path d='m 123,244 v 7 l 2,2 h 4 l 2,-2 v -7'  />
	 <path d='m 134,244 v 7 l 2,2 h 4 l 2,-2 v -7'  />
	 <path d='m 146,244 v 7 l 2,2 h 4 l 2,-2 v -7' />
	 <path d='m 146,211 v 8 l 2,2 h 4 l 2,-2 v -8' />
	 <path d='m 74,116 v 5 l 4,4 4,-4 v -5' />
	 <path d='m 90,123 v -5 m -4,-2 v 7 l 2,2 2,-2 2,2 2,-2 v -7' />
	 <path style='stroke-linecap:round' d='m 98,125 7,-8 m -7,0 7,8' />
	 <path style='stroke-linecap:round' d='m 88,219 4,-4 m -4,0 4,4' />
	 <path d='m 118,116 v 9 l -2,2 h -6 m 0,-11 v 5 l 2,2 h 6' />
	 <path d='m 166,244 v 9 l -2,2 h -6 m 0,-11 v 5 l 2,2 h 6' />
	 <path style='stroke-linejoin:round' d='m 121,117 h 8 v 1 l -7,7 h 8' />
	 <path d='m 150,112 v 15' />
	 <path style='stroke-linecap:round' d='m 170,117 2,-2 h 1 l 2,2 h 1 l 2,-2' />
	 <path d='m 171,110 v -9 h 5 l 2,2 v 7' />
	 <path d='m 182,103 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='M 9,133 H 1 m 8,4 H 1 m 9,-8 H 6 l -3,3 v 6 l 3,3 h 4' />
	 <path style='stroke-linecap:round' d='m 82,45 -5,-5 v -1 l -1,-1 v -3 l 1,-1 h 2 l 1,1 v 2 l -3,3 h -1 l -1,1 v 3 l 1,1 h 2 l 4,-4' />
	 <path d='m 104,33 h -1 l -2,2 v 8 l 2,2 h 1' />
	 <path d='M 90,38 V 33 H 88' />
	 <path style='stroke-linecap:round' d='m 123,44 3,-3 3,3' />
	 <path d='M 131,40 H 121' />
	 <path d='M 126,46 V 34' />
	 <path style='stroke-linecap:round' d='m 123,36 3,3 3,-3' />
	 <path style='stroke-linecap:round' d='M 44,44 46,34' />
	 <path style='stroke-linecap:round' d='M 39,44 41,34' />
	 <path d='M 38,36 H 48' />
	 <path d='M 37,42 H 47' />
	 <path d='m 54,32 v 14 m 4,-11 h -6 l -1,1 v 2 l 1,1 h 4 l 1,1 v 2 l -1,1 h -6' />
	 <path d='m 112,33 h 1 l 2,2 v 8 l -2,2 h -1' />
	 <path d='m 134,40 h 8' />
	 <path d='m 138,36 v 8' />
	 <path d='m 150,48 v -5 h -2' />
	 <path d='m 158,40 h 8' />
	 <path style='stroke-linecap:round' d='m 182,44 9,-9' />
	 <path style='stroke-linecap:round' d='m 153,49 -6,6 6,6' />
	 <path style='stroke-linecap:round' d='m 171,49 6,6 -6,6' />
	 <path d='m 167,54 h -9' />
	 <path d='m 167,58 h -9' />
	 <path d='m 186,62 v -2 m -4,-8 v -1 l 2,-2 h 4 l 2,2 v 1 l -4,4 v 3' />
	 <path d='m 122,74 v 1 l 2,2 h 4 l 2,-2 V 64' />
	 <path d='M 134,64 V 78' />
	 <path style='stroke-linecap:round' d='m 142,65 -6,6 6,6' />
	 <path d='m 146,64 v 13 h 9' />
	 <path style='stroke-linejoin:round' d='M 158,78 V 65 l 4,4 4,-4 v 13' />
	 <path style='stroke-linejoin:round' d='m 178,64 v 14 m -8,0 V 65 l 8,8' />
	 <path d='m 182,67 v 8 l 2,2 h 4 l 2,-2 v -8 l -2,-2 h -4 z' />
	 <path style='stroke-linecap:round' d='m 170,86 4,-4 h 1 l 4,4' />
	 <path d='m 181,95 h 11' />
	 <path d='m 159,93 h 5 V 81 h -5' />
	 <path style='stroke-linejoin:round' d='m 26,177 h 3 l 1,1 -1,1 h -1 l -1,1 v 1 h 4' />
	 <path style='stroke-linejoin:round' d='m 38,177 h 3 l 1,1 -1,1 1,1 -1,1 h -3' />
	 <path style='stroke-linejoin:round' d='m 163,185 h 3 l 1,1 -1,1 h -1 l -1,1 v 1 h 4' />
	 <path style='stroke-linejoin:round' d='m 169,178 h 3 l 1,1 -1,1 1,1 -1,1 h -3' />
	 <path style='stroke-linecap:round' d='m 53,179 2,-2' />
	 <g>
	   <path style='stroke-linecap:round' d='m 113,178 1,-1' />
	   <path d='m 114,182 v -5' />
	 </g>
	 <g transform='translate(33,1)'>
	   <path style='stroke-linecap:round' d='m 113,178 1,-1' />
	   <path d='m 114,182 v -5' />
	 </g>
	 <path d='m 125,177 h 2 l 1,1 v 2 l -1,1 h -2 l -1,-1 v -2 z' />
	 <path d='m 152,184 v 3 h 3' />
	 <path d='m 155,184 v 6' />
	 <path style='stroke-linecap:round' d='m 146,187 8,-8' />
	 <g transform='translate(45,1)'>
	   <path   style='stroke-linecap:round' d='m 113,178 1,-1' />
	   <path     d='m 114,182 v -5' />
	 </g>
	 <path style='stroke-linecap:round' d='m 158,187 8,-8' />
	 <path style='stroke-linecap:round' d='m 170,187 8,-8' />
	 <path d='m 176,184 v 3 h 3' />
	 <path d='m 179,184 v 6' />
	 <path d='m 5,177 h 2 l 1,1 v 2 l -1,1 H 5 l -1,-1 v -2 z' />
	 <path d='m 18,160 v 2' />
	 <path d='m 15,171 h 3' />
	 <path d='m 18,164 v 10' />
	 <path d='m 33,166 v -1 l -1,-1 h -4 l -1,1 v 5 l 1,1 h 4 l 1,-1 v -1' />
	 <path d='m 30,161 v 13' />
	 <path d='m 45,164 v -1 l -1,-1 h -2 l -1,1 v 8 l -1,1 h -1' />
	 <path d='m 47,172 h -5 l -1,-1' />
	 <path d='m 39,167 h 5' />
	 <path style='stroke-linecap:round' d='m 52,162 1,2' />
	 <path style='stroke-linecap:round' d='m 53,164 h 3 l 2,2 v 2 l -2,2 h -3 l -2,-2 v -2 z' />
	 <path style='stroke-linecap:round' d='m 52,172 1,-2' />
	 <path style='stroke-linecap:round' d='m 57,172 -1,-2' />
	 <path style='stroke-linecap:round' d='m 56,164 1,-2' />
	 <path d='m 18,180 v 6' />
	 <path d='m 15,183 h 6' />
	 <path d='m 15,188 h 6' />
	 <path d='m 62,160 v 4 l 4,4 4,-4 v -4' />
	 <path d='m 66,168 v 6' />
	 <path d='m 62,172 h 8' />
	 <path d='m 62,169 h 8' />
	 <path d='m 78,160 v 7' />
	 <path d='m 78,168 v 7' />
	 <path d='m 93,162 h -5 l -1,1 v 5 l 1,1 h 5' />
	 <path d='m 87,165 h 5 l 1,1 v 5 l -1,1 h -5' />
	 <path d='m 100,161 v 2' />
	 <path d='m 104,161 v 2' />
	 <path d='m 83,177 h -8 l -1,1 v 3 l 1,1 c 0,0 3,0 3,0' />
	 <path d='m 78,177 v 12' />
	 <path d='m 81,177 v 12' />
	 <path d='M 62,191 V 180' />
	 <path d='m 62,184 3,3 h 1 l 3,-3' />
	 <path d='m 69,180 v 8' />
	 <path d='m 99,190 h 2 l 1,-1 v -1' />
	 <path d='m 87,239 h 2 l 1,-1 v -1' />
	 <path d='m 144,164 h 10 v 6' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 134,186 2,-2 -2,-2' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 139,186 2,-2 -2,-2' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 141,170 -2,-2 2,-2' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 136,170 -2,-2 2,-2' />
	 <path d='m 186,179 v 3 l -4,4 v 1 l 2,2 h 4 l 2,-2 v -1' />
	 <path d='m 186,178 v -1' />
	 <path d='m 182,147 v 2 l 4,4 4,-4 v -2' />
	 <path d='m 186,158 v -5' />
	 <path d='m 182,146 v -2' />
	 <path d='m 190,146 v -2' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 89,184 1,1 1,-1 -1,-1 z' />
	 <path d='M 10,77 H 4 L 2,75 v -8 l 2,-2 h 5 l 2,2 v 6 l -1,1 H 6 L 5,73 v -4 l 1,-1 h 2 v 6' />
	 <path d='M 6,103 V 98 H 8' />
	 <path style='stroke-linecap:round' d='m 16,194 1,-1' />
	 <g>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <path style='stroke-linecap:round' d='M 8,194 7,193' />
	 <g transform='translate(12)'>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <path style='stroke-linecap:round' d='m 28,194 1,-1 h 2 l 1,1' />
	 <path style='stroke-linecap:round' d='m 40,194 1,-1 h 2 l 1,1 h 1 l 1,-1' />
	 <g transform='translate(24)'>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 65,194 1,1 1,-1 -1,-1 z' />
	 <path d='m 52,192 v 2' />
	 <path d='m 56,192 v 2' />
	 <g transform='translate(36)'>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <g transform='translate(48)'>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <path d='m 74,206 v -9 l 4,-4 h 1' />
	 <path d='m 83,193 h -4 v 12 h 4' />
	 <path d='M 82,200 H 74' />
	 <path d='m 94,196 v -1 l -2,-2 h -4 l -2,2 v 7 l 2,2 h 4 l 2,-2 v -1' />
	 <path d='m 46,68 v -1 l -2,-2 h -4 l -2,2 v 8 l 2,2 h 4 l 2,-2 v -1' />
	 <path d='m 87,207 h 2 l 1,-1 v -2' />
	 <path d='m 107,195 h -9 v 10 h 9' />
	 <path d='M 105,200 H 98' />
	 <path d='m 117,200 h -7 m 9,-5 h -9 v 10 h 9' />
	 <path style='stroke-linecap:round' d='m 102,193 2,2' />
	 <path style='stroke-linecap:round' d='m 113,195 2,-2' />
	 <path style='stroke-linecap:round' d='m 125,194 1,-1 h 1 l 1,1' />
	 <path d='m 129,200 h -7 m 9,-5 h -9 v 10 h 9' />
	 <path d='m 141,200 h -7 m 9,-5 h -9 v 10 h 9' />
	 <path style='stroke-linecap:round' d='m 162,194 1,-1' />
	 <path d='m 162,196 v 10' />
	 <path d='m 150,196 v 10' />
	 <path style='stroke-linecap:round' d='m 150,194 -1,-1' />
	 <path d='m 136,192 v 1' />
	 <path d='m 140,192 v 1' />
	 <path style='stroke-linecap:round' d='m 173,194 1,-1 h 1 l 1,1' />
	 <path d='m 174,196 v 10' />
	 <path d='m 186,196 v 10' />
	 <path d='m 162,228 v 10' />
	 <path d='m 150,228 v 10' />
	 <path d='m 174,228 v 10' />
	 <path d='m 186,228 v 10' />
	 <path d='m 184,193 v 2' />
	 <path d='m 188,193 v 2' />
	 <path d='m 2,221 h 6 l 2,-2 v -8 L 8,209 H 2 Z' />
	 <path d='M 0,214 H 5' />
	 <path style='stroke-linejoin:round' d='m 22,211 v 11 m -8,0 v -10 l 8,8'/>
	 <path style='stroke-linecap:round' d='m 16,210 1,-1 h 1 l 1,1 h 1 l 1,-1' />
	 <path style='stroke-linecap:round' d='m 30,210 -1,-1' />
	 <path style='stroke-linecap:round' d='m 41,210 1,-1' />
	 <path style='stroke-linecap:round' d='m 52,210 1,-1 h 1 l 1,1' />
	 <path style='stroke-linecap:round' d='m 64,210 1,-1 h 1 l 1,1 h 1 l 1,-1' />
	 <path d='m 76,208 v 2' />
	 <path d='m 80,208 v 2' />
	 <path d='m 26,214 v 5 l 2,2 h 4 l 2,-2 v -5 l -2,-2 h -4 z' />
	 <path d='m 38,214 v 5 l 2,2 h 4 l 2,-2 v -5 l -2,-2 h -4 z' />
	 <path d='m 50,214 v 5 l 2,2 h 4 l 2,-2 v -5 l -2,-2 h -4 z' />
	 <path d='m 62,214 v 5 l 2,2 h 4 l 2,-2 v -5 l -2,-2 h -4 z' />
	 <path d='m 74,214 v 5 l 2,2 h 4 l 2,-2 v -5 l -2,-2 h -4 z' />
	 <path style='stroke-linecap:round' d='m 30,242 -1,-1' />
	 <path style='stroke-linecap:round' d='m 41,242 1,-1' />
	 <path style='stroke-linecap:round' d='m 52,242 1,-1 h 1 l 1,1' />
	 <path style='stroke-linecap:round' d='m 64,242 1,-1 h 1 l 1,1 h 1 l 1,-1' />
	 <path d='m 76,241 v 2' />
	 <path d='m 80,241 v 2' />
	 <path d='m 26,247 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='m 38,247 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='m 50,247 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='m 62,247 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='m 74,247 v 4 l 2,2 h 4 l 2,-2 v -4 l -2,-2 h -4 z' />
	 <path d='m 62,229 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 78,233 h 4 v -1 -2 l -1,-1 h -2 l -1,1 v 5 l 2,2 h 2 m -8,-8 h 2 l 2,2 v 6 h -3 l -1,-1 v -2 l 1,-1 h 3' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 65,226 1,1 1,-1 -1,-1 z' />
	 <path style='stroke-linecap:round' d='M 6,226 5,225' />
	 <path style='stroke-linecap:round' d='m 17,226 1,-1' />
	 <path style='stroke-linecap:round' d='m 28,226 1,-1 h 1 l 1,1' />
	 <path style='stroke-linecap:round' d='m 40,226 1,-1 h 1 l 1,1 h 1 l 1,-1' />
	 <path d='m 52,225 v 2' />
	 <path d='m 56,225 v 2' />
	 <path d='m 50,229 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 38,229 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 26,229 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 14,229 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 2,229 h 6 l 2,2 v 6 H 3 l -1,-1 v -2 l 1,-1 h 7' />
	 <path d='m 14,101 h 6 l 2,2 v 6 h -7 l -1,-1 v -2 l 1,-1 h 7' />
	 <path style='stroke-linecap:round' d='m 16,242 1,-1 h 1 l 1,1 h 1 l 1,-1' />
	 <path d='m 15,254 v -9 h 5 l 2,2 v 7' />
	 <path d='M 8,243 H 5 l -1,1 v 2 l 4,4 v 2 l -1,1 H 5 l -1,-1 v -2 l 1,-1' />
	 <path d='m 122,233 h 8 v -2 l -2,-2 h -4 l -2,2 v 4 l 2,2 h 6' />
	 <path d='m 134,233 h 8 v -2 l -2,-2 h -4 l -2,2 v 4 l 2,2 h 6' />
	 <path style='stroke-linecap:round' d='m 103,226 -1,-1' />
	 <path style='stroke-linecap:round' d='m 114,226 1,-1' />
	 <path style='stroke-linecap:round' d='m 125,226 1,-1 h 1 l 1,1' />
	 <path d='m 136,225 v 2' />
	 <path d='m 140,225 v 2' />
	 <path style='stroke-linecap:round' d='m 151,226 -1,-1' />
	 <path style='stroke-linecap:round' d='m 162,226 1,-1' />
	 <path style='stroke-linecap:round' d='m 162,210 1,-1' />
	 <path style='stroke-linecap:round' d='m 173,226 1,-1 h 1 l 1,1' />
	 <path d='m 184,225 v 2' />
	 <path d='m 188,225 v 2' />
	 <path style='stroke-linecap:round' d='m 115,242 -1,-1' />
	 <path style='stroke-linecap:round' d='m 126,242 1,-1' />
	 <path style='stroke-linecap:round' d='m 137,242 1,-1 h 1 l 1,1' />
	 <path d='m 148,241 v 2' />
	 <path d='m 152,241 v 2' />
	 <path style='stroke-linecap:round' d='m 115,210 -1,-1' />
	 <path style='stroke-linecap:round' d='m 126,210 1,-1' />
	 <path style='stroke-linecap:round' d='m 137,210 1,-1 h 1 l 1,1' />
	 <path d='m 148,208 v 2' />
	 <path d='m 152,208 v 2' />
	 <path d='m 134,211 v 8 l 2,2 h 4 l 2,-2 v -8' />
	 <path d='m 122,211 v 8 l 2,2 h 4 l 2,-2 v -8' />
	 <path d='m 110,211 v 8 l 2,2 h 4 l 2,-2 v -8' />
	 <path d='m 190,244 v 9 l -2,2 h -6 m 0,-11 v 5 l 2,2 h 6' />
	 <path d='m 173,251 h 3 l 2,-2 v -2 l -2,-2 h -3 m 0,10 v -14' />
	 <path d='m 184,243 v -2' />
	 <path d='m 188,243 v -2' />
	 <path d='m 173,219 h 3 l 2,-2 v -2 l -2,-2 h -3 m 0,9 v -12 m -3,0 h 6 m -6,12 h 6' />
	 <path style='stroke-linecap:round' d='m 162,243 1,-1' />
	 <path d='m 183,223 v -11 l 2,-2 h 2 l 2,2 v 1 l -2,2 2,2 v 2 l -1,1 h -3' />
	 <path style='stroke-linecap:round' d='m 105,244 -5,10 m 4,-8 2,2 v 2 l -2,2 h -3 l -2,-2 v -2 l 2,-2 z' />
	 <path d='m 86,248 h 8 m -4,2 v 2 m 0,-8 v 2' />
	 <path style='stroke-linecap:round' d='m 104,211 2,2 v 6 l -2,2 h -4 l -2,-2 v -6 l 2,-2 z m -7,10 10,-10' />
	 <path d='M 54,81 V 94 M 49,81 h 10' />
	 <path d='m 50,77 h 6 l 2,-2 v -8 l -2,-2 h -6 z' />
	 <path d='M 114,78 V 64' />
	 <path d='M 19,62 V 48' />
	 <path d='m 106,64 v 14 m -8,-7 h 8 m -8,7 V 64' />
	 <path d='m 94,68 v -1 l -2,-2 h -4 l -2,2 v 8 l 2,2 h 6 v -6' />
	 <path d='m 81,71 h -7 m 9,-6 h -9 v 13' />
	 <path d='m 71,65 h -9 v 12 h 9 m -2,-6 h -7' />
	 <path d='m 14,73 h 8 m -8,5 c 0,-3 0,-9 0,-9 l 4,-4 4,4 v 9' />
	 <path d='m 26,71 h 6 l 2,-2 v -2 l -2,-2 h -6 v 12 h 6 l 2,-2 v -2 l -2,-2' />
	 <path d='m 18,44 v 2 m 0,-14 v 10' />
	 <path d='m 32,34 v 4 m -4,-4 v 4' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 69,43 h 1 v 1 h -1 z m -6,-8 h 1 v 1 h -1 z m -1,9 9,-9 M 125,59 h 1 v 1 h -1 z m 0,-6 h 1 v 1 h -1 z M 137,53 h 1 v 1 h -1 z m 1,10 v -4 h -1 M 173,44 h 1 v 1 h -1 z' />
	 <path style='stroke-linecap:round' d='m 15,52 3,-3 h 1' />
	 <path style='stroke-linejoin:round' d='m 26,51 v -1 l 1,-1 h 6 l 2,2 v 1 l -9,9 h 10' />
	 <path d='m 45,55 2,2 v 2 l -2,2 h -6 l -1,-1 v -1 m 0,-8 v -1 l 1,-1 h 6 l 2,2 v 2 l -2,2 h -5' />
	 <path style='stroke-linecap:round' d='m 56,49 -6,6 v 2' />
	 <path d='m 57,54 v 8' />
	 <path d='M 72,49 H 62 v 5 h 7 l 2,2 v 3 l -2,2 h -5 l -2,-2 v -1' />
	 <path d='m 83,49 h -6 l -3,3 v 7 l 2,2 h 5 l 2,-2 v -2 l -2,-2 h -7' />
	 <path style='stroke-linecap:round' d='m 95,49 v 4 l -8,8' />
	 <path style='stroke-linecap:round;stroke-linejoin:round' d='m 6,54 h 1 v 2 H 6 Z m 3,-5 2,2 v 8 L 9,61 H 4 L 2,59 v -8 l 2,-2 z' />
	 <path d='m 105,55 2,2 v 2 l -2,2 h -5 l -2,-2 v -2 l 2,-2 h 5 l 2,-2 v -2 l -2,-2 h -5 l -2,2 v 2 l 2,2' />
	 <path d='m 110,61 h 6 l 3,-3 v -7 l -2,-2 h -5 l -2,2 v 2 l 2,2 h 7' />
	 <path d='M 85,49 H 96' />
	 <path d='M 60,57 H 49' />
	 <g transform='translate(-12)'>
	   <path style='stroke-linejoin:round' d='m 14,206 v -6 l 4,-4 4,4 v 6' />
	   <path d='m 14,203 h 8' />
	 </g>
	 <path d='m 160,126 h 1 l 2,-2 v -3 l 1.5,-1.5 -1.5,-1.5 v -3 l -2,-2 h -1' />
	 <path d='m 140,126 h -1 l -2,-2 v -3 l -1.5,-1.5 1.5,-1.5 v -3 l 2,-2 h 1' />
   </g>
 </svg>`],{type:"image/svg+xml"})),t));let a=this.queryTexture(n);if(!a)return console.error("createImageFontResource() invalid parent image id",n);const i="object"==typeof t&&"border"in t?t.border:0;t="object"==typeof t&&"fontId"in t?t.fontId:v.length;const o=k[n],l=v[t]={texture:null,glyphs:[],width:0,height:0,ready:!1},e=t=>{t&&(a=this.queryTexture(n)),l.texture=o.texture,l.width=a.width,l.height=a.height;var e=Math.floor(a.width/16),r=Math.floor(a.height/16);for(let t=32;t<256;++t)l.glyphs.push({x:e*(t%16)+i,y:r*Math.floor(t/16)+i,w:e-2*i,h:r-2*i,xoff:0,yoff:0});l.glyphs=x(l),l.ready=!0};return o.ready?e(!1):o.img&&o.img.addEventListener("load",()=>{e(!0)}),t},this.queryTexture=function(t){if(!t||t<1||t>=k.length)return null;t=k[t];return{width:t.width,height:t.height,sc:t.sc,cx:t.cx/t.width,cy:t.cy/t.height,ready:t.ready}},this.setTextureCenter=function(t,r,n){if(0<t&&t<k.length){const a=k[t];t=()=>{var t=a.width||1,e=a.height||1;a.cx=r*t,a.cy=n*e};if(a.ready)t();else{const e=a.img||(a.parent?k[a.parent].img:null);e&&e.addEventListener("load",t)}}};const _=t=>(t.texture!=s&&(this.flush(),s=t.texture),t);function L(t,e,r=1,n=1){i[o++]=t,i[o++]=e,i[o++]=u[u.length-1][4],i[o++]=O.int14(r,n)}function M(t,e,r){i[o++]=t,i[o++]=e,i[o++]=O.uint32(r),i[o++]=O.int14(1,1)}this.color=function(t,e,r,n=255){var a;return Array.isArray(t)?u[u.length-1][4]=O.rgba(t[0],t[1],t[2],t[3]):(void 0===e?(t=(4278190080&(a=t))>>>24,e=(16711680&a)>>>16,r=(65280&a)>>>8,n=255&a):void 0===r&&(n=e,t=(4278190080&(a=t))>>>24,e=(16711680&a)>>>16,r=(65280&a)>>>8),u[u.length-1][4]=O.rgba(t,e,r,n)),this},this.colorf=function(t,e,r,n=1){return u[u.length-1][4]=O.rgba(255*t,255*e,255*r,255*n),this},this.lineWidth=function(t){return void 0===t?u[u.length-1][5]:(t==u[u.length-1][5]||(this.flush(),u[u.length-1][5]=Number(t)),this)},this.blend=function(t){return void 0===t?n:(t===n||(this.flush(),n=t,R()),this)},this.save=function(){return u.length<8&&u.push(u[u.length-1].slice()),this},this.transform=function(t,e,r=0,n=1){this.flush();const a=u[u.length-1];return"object"==typeof t?(a[0]+=l[0]*t.x+l[3]*t.y,a[1]+=l[1]*t.x+l[4]*t.y,"rot"in t&&(a[2]+=t.rot),"sc"in t&&(a[3]*=t.sc)):(a[0]+=l[0]*t+l[3]*e,a[1]+=l[1]*t+l[4]*e,a[2]+=r,a[3]*=n),h(a,l),this},this.setTransform=function(t,e,r=0,n=1){this.flush();const a=u[u.length-1];return a[0]=t,a[1]=e,a[2]=r,a[3]=n,h(a,l),this},this.restore=function(){var t=u.length;return t<2||(this.flush(),u.pop(),h(u[t-2],l)),this},this.reset=function(){return this.flush(),u.length=1,u[0][0]=u[0][1]=u[0][2]=0,u[0][3]=u[0][5]=1,u[0][4]=O.rgba(255,255,255),h(u[0],l),this},this.fillText=function(e,r,t,n=0,a=0){var i=v[n];if(void 0===i||null===i.texture)return console.error("font not ready",i);_(i),0!==a&&(n=this.measureText(n,t),a&this.ALIGN_RIGHT?e-=n.width:a&this.ALIGN_CENTER&&(e-=n.width/2),a&this.ALIGN_BOTTOM?r-=n.height:a&this.ALIGN_MIDDLE&&(r-=n.height/2));const o=String(t);for(let t=0;t<o.length;++t){var l,h,s,d,u,c,p,f,m=o.charCodeAt(t);m<32||256<m||(h=e+(l=i.glyphs[m-32]).xoff,s=r+l.yoff,d=h+l.w,u=s+l.h,c=l.tx1,p=l.ty1,f=l.tx2,m=l.ty2,L(h,s,c,p),L(d,s,f,p),L(h,u,c,m),L(h,u,c,m),L(d,s,f,p),L(d,u,f,m),++E==b&&this.flush(),e+=l.w)}},this.measureText=function(t,r){var n=v[t];if(void 0===n||null===n.glyphs||!n.ready)return null;var e=n.glyphs[92],t=n.glyphs[45];let a={height:e.yoff+e.h,fontBoundingBoxAscent:t.h,fontBoundingBoxDescent:e.yoff+e.h-t.yoff-t.h};if(void 0!==r){"string"!=typeof r&&(r=""+r);for(let e=a.width=0;e<r.length;++e){let t=r.charCodeAt(e);(t<32||256<t)&&(t=32);var i=n.glyphs[t-32];a.width+=i.w}}return a},this.clipRect=function(t,e,r,n){this.flush(),"number"==typeof t?(d.enable(d.SCISSOR_TEST),d.scissor(t,a.height-e-n,r,n)):(d.scissor(0,0,a.width,a.height),d.disable(d.SCISSOR_TEST))},this.fillRect=function(t,e,r,n){_(C);r=t+r,n=e+n;L(t,e),L(r,e),L(t,n),L(t,n),L(r,e),L(r,n),++E==b&&this.flush()},this.drawRect=function(t,e,r,n){var a=u[u.length-1][5],i=a/2,r=t+r,a=(e+=i)+n-a;this.drawLine(t,e,r,e),this.drawLine(r-i,e+i,r-i,a-i),this.drawLine(r,a,t,a),this.drawLine(t+i,a-i,t+i,e+i)},this.drawLine=function(t,e,r,n){_(C);var a=r-t,i=n-e,o=Math.sqrt(a*a+i*i),l=u[u.length-1][5]/2,h=l*-i/o,s=l*a/o,i=t+h,l=e+s,a=r+h,o=n+s;r-=h,n-=s,L(t-=h,e-=s),L(r,n),L(i,l),L(i,l),L(r,n),L(a,o),++E==b&&this.flush()},this.drawPoints=function(r){var n=u[u.length-1][5],a=n/2;if(n<=2)for(let t=0,e=r.length-1;t<e;t+=2)this.fillRect(r[t]-a,r[t+1]-a,n,n);else{_(k[I]);var i=A,o=A;for(let t=0,e=r.length-1;t<e;t+=2){var l=r[t]-a,h=r[t+1]-a,s=l+n,d=h+n;L(l,h,0,0),L(s,h,i,0),L(l,d,0,o),L(l,d,0,o),L(s,h,i,0),L(s,d,i,o),++E==b&&this.flush()}}},this.drawLineStrip=function(r){for(let t=2,e=r.length-1;t<e;t+=2)this.drawLine(r[t-2],r[t-1],r[t],r[t+1]);this.drawPoints(r.slice(2,-2))},this.drawLineLoop=function(r){var n=r[r.length-2],a=r[r.length-1];for(let t=0,e=r.length-1;t<e;t+=2){var i=r[t],o=r[t+1];this.drawLine(n,a,i,o),n=i,a=o}this.drawPoints(r)},this._drawImage=function(t,e,r,n,a,i,o,l,h,s=0,d=0,u=0,c=0){var p=_(k[t]),f=Math.cos(u),m=Math.sin(u),v=-s,g=-d,t=v+l,u=g+h,s=f*v-m*g+i,d=m*v+f*g+o,l=f*t-m*g+i,h=m*t+f*g+o,g=f*v-m*u+i,v=m*v+f*u+o,i=f*t-m*u+i,o=m*t+f*u+o;let y=A*e/p.width,w=A*r/p.height,x=y+A*n/p.width,T=w+A*a/p.height;1&c&&(p=y,y=x,x=p),2&c&&(c=w,w=T,T=c),L(s,d,y,w),L(l,h,x,w),L(g,v,y,T),L(g,v,y,T),L(l,h,x,w),L(i,o,x,T),++E==b&&this.flush()},this.drawImage=function(t,e=0,r=0,n=0,a=1,i=this.FLIP_NONE){var o=_(k[t]);a*=o.sc,this._drawImage(o.parent||t,o.x,o.y,o.width,o.height,e,r,o.width*a,o.height*a,o.cx*a,o.cy*a,n,i)},this.stretchImage=function(t,e,r,n,a){var i=_(k[t]);this._drawImage(i.parent||t,i.x,i.y,i.width,i.height,e,r,n,a)},this.drawSprite=function(t){"color"in t&&this.color(t.color);var e=t.x||0,r=t.y||0,n=t.rot||0,a=t.sc||1;this.drawImage(t.image,e,r,n,a,t.flip)},this.fillTriangle=function(t,e,r,n,a,i){_(C),L(t,e),L(r,n),L(a,i),L(t,e),L(t,e),L(t,e),++E==b&&this.flush()},this.fillTriangles=function(t,e){if(e){for(var r=6*Math.floor(t.length/12),n=0;n<r;++n)M(t[2*n],t[2*n+1],e[n]),n%6==0&&++E==b&&this.flush();if(2*r<t.length){for(n=r;n<e.length;++n)M(t[2*n],t[2*n+1],e[n]);M(0,0,0),M(0,0,0),M(0,0,0),++E==b&&this.flush()}}else for(var n=0,a=Math.floor(t.length/6);n<a;++n)this.fillTriangle(t[n],t[n+1],t[n+2],t[n+3],t[n+4],t[n+5])},this.drawTiles=function(t,e,r,n=void 0,a=void 0,i=e){for(var o=_(k[t]),l=o.width,h=o.height,s=0;s<r;++s)for(var d=0;d<e;++d){var u=s*i+d;a&&this.color(a[u]);u=n?t+n[u]:t;this.drawImage(u,d*l,s*h)}},this.drawImages=function(t,e,r,n){for(var a=Math.floor(n.length/e),i=0!=(r&this.COMP_COLOR_RGBA),o=255,l=255,h=255,s=255,d=0;d<a;++d){var u=n.subarray(d*e,d*e+e),c=t,p=0;if(r&this.COMP_IMG_OFFSET&&(c+=u[p++]),c&&!(c>=k.length)){var f=u[p++],m=u[p++],v=r&this.COMP_ROT?u[p++]:0,g=r&this.COMP_SCALE?u[p++]:1;if(i){if(o=r&this.COMP_COLOR_R?u[p++]:o,l=r&this.COMP_COLOR_G?u[p++]:l,h=r&this.COMP_COLOR_B?u[p++]:h,(s=r&this.COMP_COLOR_A?u[p++]:s)<=0)continue;this.color(o,l,h,s)}this.drawImage(c,f,m,v,g)}}},this.flush=function(){d.uniform2f(g,a.width,a.height),d.uniformMatrix3fv(y,!1,l),d.uniform1i(w,0),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,s),d.bufferData(d.ARRAY_BUFFER,i,d.STREAM_DRAW),d.drawArrays(d.TRIANGLES,0,6*E),d.flush(),E=0,o=0},this._frameBegin=function(t,e,r){d.viewport(0,0,a.width,a.height),d.clearColor(t,e,r,1),d.clear(d.COLOR_BUFFER_BIT),d.enable(d.BLEND),R()},this._frameEnd=this.reset,c=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,c),c=t*e,d.vertexAttribPointer(p,2,d.FLOAT,!1,c,0*t),d.vertexAttribPointer(f,4,d.UNSIGNED_BYTE,!0,c,2*t),d.vertexAttribPointer(m,2,d.SHORT,!1,c,3*t);const C=k[this.createTexture(2,2,new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]))],I=this.createCircleTexture(32);this.setTextureCenter(I,.5,.5),k[I].sc=1/64,this.createImageFontResource(0),s=C.texture,P(this,"ALIGN_LEFT",0),P(this,"ALIGN_CENTER",1),P(this,"ALIGN_RIGHT",2),P(this,"ALIGN_TOP",0),P(this,"ALIGN_MIDDLE",4),P(this,"ALIGN_BOTTOM",8),P(this,"FLIP_NONE",0),P(this,"ALIGN_LEFT_TOP",0),P(this,"ALIGN_CENTER_TOP",1),P(this,"ALIGN_RIGHT_TOP",2),P(this,"ALIGN_LEFT_MIDDLE",4),P(this,"ALIGN_CENTER_MIDDLE",5),P(this,"ALIGN_RIGHT_MIDDLE",6),P(this,"ALIGN_LEFT_BOTTOM",8),P(this,"ALIGN_CENTER_BOTTOM",9),P(this,"ALIGN_RIGHT_BOTTOM",10),P(this,"FLIP_X",1),P(this,"FLIP_Y",2),P(this,"FLIP_XY",3),P(this,"IMG_CIRCLE",I),P(this,"IMG_SQUARE",C),P(this,"BLEND_NONE",0),P(this,"BLEND_ALPHA",1),P(this,"BLEND_ADD",2),P(this,"BLEND_MOD",4),P(this,"BLEND_MUL",8),P(this,"COMP_IMG_OFFSET",1),P(this,"COMP_ROT",8),P(this,"COMP_SCALE",16),P(this,"COMP_COLOR_R",32),P(this,"COMP_COLOR_G",64),P(this,"COMP_COLOR_B",128),P(this,"COMP_COLOR_A",256),P(this,"COMP_COLOR_RGB",224),P(this,"COMP_COLOR_RGBA",480)}}(),arcajs.audio=function(){let u=new(window.AudioContext?AudioContext:webkitAudioContext);let h=[],s=[];for(let t=0;t<16;++t)s.push(null);let n=null,d=u.createGain();function c(){let t=0;for(;t<16;++t)if(null===s[t])return t;return 16}function p(t,e){if("noi"===t)return function(t=2093){if(null===n){var e=2*u.sampleRate;n=u.createBuffer(1,e,u.sampleRate),output=n.getChannelData(0);for(let t=0;t<e;t++)output[t]=2*Math.random()-1}let r=u.createBufferSource();return r.buffer=n,r.loop=!0,0<t&&(r.playbackRate.value=t/2093),r}(e);let r=u.createOscillator();switch(r.start||(r.start=r.noteOn),t){case"saw":r.type="sawtooth";break;case"sin":r.type="sine";break;case"squ":case"sqr":r.type="square";break;case"tri":r.type="triangle"}return r.frequency.value=e,r}function f(t,e,r){t.start||(t.start=t.noteOn);let n=u.createGain();n.gain.value=e,t.connect(n);let a=n;if(r){let t;u.createStereoPanner?(t=u.createStereoPanner(),t.pan.value=r):(t=u.createPanner(),t.panningModel="equalpower",t.setPosition(r,0,1-Math.abs(r))),a.connect(t),a=t}return a.connect(d),n}function y(t,e,r){if("number"==typeof t)return t;if("0"<=t[0]&&t[0]<="9")return parseFloat(t);let n;switch(t){case"B":case"H":n=2;break;case"C":n=3;break;case"D":n=5;break;case"E":n=7;break;case"F":n=8;break;case"G":n=10;break;case"-":return 0;default:n=0}"b"==e?--n:"#"==e&&++n,2<n&&--r;e=27.5*Math.pow(2,r),r=Math.pow(2,1/12);return e*Math.pow(r,n)}function i(t){function h(t,e,r,n){let a=1;t.charAt(e)in{"-":!0,"+":!0}&&("-"===t.charAt(e)&&(a=-1),++e);let i=NaN,o=!1,l=.1;for(;e<t.length;){var h=t.charAt(e);if("."!==h){if(!/\d/.test(h))break;Number.isNaN(i)&&(i=0),o?(i+=l*Number(h),l/=10):i=10*i+Number(h),++e}else{if(o)break;o=!0,++e}}return i*=a,Number.isNaN(i)?++e:(r[n]=i,--e),e}function s(t,e,r,n){for(":"===t.charAt(++e)&&++e;/\s/.test(t.charAt(e));)++e;return h(t,e,r,n)}let o=function(r){let n=[];for(let t=0,e=r.length;t<e;++t){var a=r.charAt(t);if(!/\s/.test(a))if("{"!=a){var i=[];if(t=function(r,n,a){for(var t=r.length;n<t;++n){let e=r.charAt(n);if(!/\s/.test(e)){let t=-1;if("0"<=e&&e<="9"||"."===e){var i={};if(n=h(r,n,i,"v"),t=i.v,++n>=r.length)return;e=r.charAt(n)}else{if(!(e in{"-":!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0}))return console.error("invalid note",e,"at pos",n);i=e;if(++n>=r.length)return;e=r.charAt(n);var o="#"==e||"b"==e?e:" ";if(" "!=o){if(++n>=r.length)return;e=r.charAt(n)}if("-"!=i&&!/\d/.test(e))return console.error("invalid octave",e,"at pos",n);var l=e.charCodeAt(0)-"0".charCodeAt(0);if("-"!=i){if(++n>=r.length)return;e=r.charAt(n)}t=y(i,o,l)}if("/"!=e&&"*"!=e)return console.error("invalid duration signifier at pos",n);o="/"==e,l={};n=s(r,n,l,"v"),"v"in l&&0<l.v&&(a.push(t),a.push(o?1/l.v:l.v));break}}return n}(r,t,i),2!==i.length)break;n.push(i)}else{i={};t=function(t,e,r){for(var n=t.length;e<n;++e){var a=t.charAt(e);if(!/\s/.test(a)){if("}"===a)break;switch(a){case"a":e=s(t,e,r,"attack");break;case"b":e=s(t,e,r,"beatLen"),"beatLen"in r&&(r.beatLen=240/r.beatLen);break;case"d":e=s(t,e,r,"decay");break;case"g":e=s(t,e,r,"gain");break;case"h":e=s(t,e,r,"hold");break;case"r":e=s(t,e,r,"release");break;case"s":e=s(t,e,r,"sustain");break;case"w":++e,":"===t.charAt(e)&&++e,t.substr(e,3)in{sin:!0,tri:!0,sqr:!0,saw:!0,noi:!0}&&(r.waveForm=t.substr(e,3)),e+=3}}}return e}(r,t+1,i),0!==Object.keys(i).length&&n.push(i)}}return n}(t),l=u.createGain();this.replay=function(t=1,e=0){let r={waveForm:"sqr",attack:0,hold:0,decay:0,sustain:1,release:0,gain:1,beatLen:240/72},n=0;l.gain.value=t,l.connect(d);for(let t=0;t<o.length;++t){var a=o[t];if(Array.isArray(a))n=function(e,t,r,n,a=0,i=0){let o=p(n.waveForm,t),l=u.createGain();var h,s,d;if(o.connect(l),a+=(h=o,s=l,d=n,t=r,n=u.currentTime+a,r=d.gain,t*=d.beatLen,h.start(n),0<d.attack?(s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(r,n+d.attack)):s.gain.setValueAtTime(r,n),d.sustain<1&&(s.gain.setValueAtTime(r,n+d.attack+d.hold),s.gain.linearRampToValueAtTime(d.sustain*r,n+d.attack+d.hold+d.decay)),0<d.release?(s.gain.linearRampToValueAtTime(0,n+t+d.release),"frequency"in h&&h.frequency.setValueAtTime(0,n+t+d.release)):"frequency"in h&&h.frequency.setValueAtTime(0,n+t),t),i){let t=u.createStereoPanner();t.pan.value=i,l.connect(t),t.connect(e)}else l.connect(e);return a}(l,a[0],a[1],r,n,e);else if("object"==typeof a)for(var i in a)r[i]=a[i]}return n},this.stop=function(){l.disconnect()},this.volume=function(t){l.gain.value=t}}return d.gain.value=1,d.connect(u.destination),{resume:function(){"running"!==u.state&&u.resume()},suspend:function(){u.suspend()},load:function(r,n,a){if(Array.isArray(r)){let e=[];for(let t=0;t<r.length;++t)e.push(this.load(r[t],n,a));return e}var t={id:h.length+1,ready:!1,url:r,buffer:null,offset:0};return h.push(t),function(t,a,i){let e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer",e.onload=()=>{u.decodeAudioData(e.response,e=>{if(!e)return console.error("error decoding file data:",a);let r=h[a-1];r.buffer=e,r.ready=!0;var n=e.getChannelData(0);for(let t=0;t<n.length;++t)if(.002<n[t]||n[t]<-.002){r.offset=t/e.sampleRate;break}i&&i(r)},t=>{console.error("decodeAudioData error",a,t)})},e.onerror=()=>{console.error("loadSample: XHR error",t)},e.send()}(r,t.id,a),t.id},replay:function(r,n=1,a=0,i=0,o=0,l=!1){if(!(0===(r=Array.isArray(r)?r[Math.floor(Math.random()*r.length)]:r)||r>h.length)){r=h[r-1];if(r.ready&&r.buffer){let t=c();if(16===t)return 4294967295;let e=u.createBufferSource();return 0!==i&&(e.playbackRate.value=Math.pow(2,i/12)),e.buffer=r.buffer,e.loop=l,s[t]={src:e,gain:f(e,n,a)},e.start(u.currentTime+o,r.offset||0),e.addEventListener("ended",()=>{s[t]=null}),t}}},loop:function(t,e=1,r=0,n=0,a=0){return this.replay(t,e,r,n,a,!0)},stop:function(t){if(void 0===t)for(let e=0;e<16;++e)if(null!==s[e]){let t=s[e].src;t.stop(),s[e]=null}let e=s[t];e&&(("src"in e?e.src:e).stop(),s[t]=null)},volume:function(e,r){if(void 0===e)return d.gain.value;if(void 0!==r){let t=s[e];t&&("gain"in t?t.gain.gain.value=r:t.volume(r))}else d.gain.value=e},fadeOut:function(t,e){let r=s[t];r&&"gain"in r&&(r.gain.gain.linearRampToValueAtTime(0,u.currentTime+e),r.src.stop(u.currentTime+e))},playing:function(t){if("running"!==u.state)return!1;if(void 0!==t)return!!s[t];for(let t=0;t<16;++t)if(null!==s[t])return!0;return!1},sound:function(t,e,r,n=1,a=0){let i=p(t.substr(0,3).toLowerCase(),this.note2freq(e)),o=c();if(16===o)return 4294967295;s[o]={src:i,gain:f(i,n,a)},i.addEventListener("ended",()=>{s[o]=null}),i.start(),i.stop(u.currentTime+r)},melody:function(t,e=1,r=0){let n=c();if(16===n)return 4294967295;let a=s[n]=new i(t);r=a.replay(e,r);setTimeout(()=>{s[n].stop(),s[n]=null},1e3*r)},uploadPCM:function(n,a=1,t=0){"object"==typeof n&&n.samples&&(a=n.channels||1,t=n.offset||0,n=n.samples);var e=u.createBuffer(a,n.length/a,u.sampleRate);for(let r=0;r<a;++r){var i=e.getChannelData(r);for(let t=0,e=n.length/a;t<e;++t)i[t]=n[t*a+r]}return h.push({id:h.length+1,ready:!0,url:"",buffer:e,offset:t}),h.length},release:function(t){if(!(0===t||t>h.length)){const e=h[t-1];e.ready=!1,e.buffer=null}},sampleRate:u.sampleRate,tracks:16,createSoundBuffer:function(){const T=audio.sampleRate,r=2*Math.PI;function e(t,e){return t%1<e?1:-1}function t(t,e){var r=e/2,n=t%1,t=1-r;return n<r?n/r:n<t?1-2*(n-r)/(1-e):(n-t)/r-1}function n(t,e){e=Math.ceil(T/2e4/e);return--n.counter<0&&(n.counter=e,n.amplPrev=n.amplitude,n.amplitude=2*Math.random()-1),n.amplitude*(1-n.counter/e)+n.amplPrev*(n.counter/e)}function a(t,e){e*=2e4;return--a.counter<0&&(a.counter=Math.ceil(Math.random()*T/e),a.amplitude=-a.amplitude),a.amplitude}var i;switch(n.counter=-1,n.amplitude=n.amplPrev=0,a.counter=-1,a.amplitude=1,(arguments=1===arguments.length&&Array.isArray(arguments[0])?arguments[0]:arguments)[0].slice(0,2)){case"si":i=function(t,e){return void 0===e||1<=e?Math.sin(r*t):(t=Math.sin(r*t),Math.sign(t)*Math.abs(t)**e)};break;case"sa":i=t;break;case"sq":i=e;break;case"bi":i=a;break;case"no":i=n;break;case"tr":i=t;break;default:throw"invalid wave form name "+JSON.stringify(arguments[0])}for(var o=0,l=3;l<arguments.length;l+=4)o+=arguments[l];for(var h,s,d,u=new Float32Array(Math.ceil(o*T)),c=0,p=0,l=1;l<arguments.length;l+=4){var f=y(arguments[l]),m=arguments[l+1]||0,v=arguments[l+2],g="number"==typeof arguments[l+3]?arguments[l+3]:function(t){switch(t){case e:case a:return.5;default:return 1}}(i);v&&(p=function(t,e,r,n,a,i,o,l,h,s,d){for(var u=l-o,c=i-a,p=s-h,f=T*d,m=1/T,v=0,g=Math.floor(r*T);v<f;++v,++g,0){var y=v/f,w=o+u*y,x=a+c*y;e[g]=Math.max(-1,Math.min(1,t(n,h+p*y)*w)),n+=x*m}return n}(i,u,c,p,h=void 0===h?f:h,f,s=void 0===s?m:s,m,d=void 0===d?g:d,g,v),c+=v),h=f,s=m,d=g}return u},mixToBuffer:function(t,e,r,n,a){"number"==typeof e&&(e=this.sampleBuffer(e));for(var i=Math.floor(t.length/2),o=e.length,l=n*(-.4*a+.6),h=n*(.4*a+.6),s=Math.round(r*audio.sampleRate),d=0;s<i&&d<o;++s,++d)t[2*s]+=e[d]*l,t[2*s+1]+=e[d]*h},clampBuffer:function(t,e,r){for(var n=0,a=t.length;n<a;++n)t[n]=Math.min(Math.max(t[n],e),r)},sampleBuffer:function(t){if(0<t&&t<=h.length)return h[t-1].buffer},note2freq:function(t){if("number"==typeof t)return t;var e=t.charAt(0);if("0"<=e&&e<="9")return parseFloat(t);if(!(e in{"-":!0,A:!0,B:!0,C:!0,D:!0,E:!0,F:!0,G:!0,H:!0}))return console.error("invalid note",e);var r=t.charAt(1),r="#"==r||"b"==r?r:" ";const n=t.charAt(" "!=r?2:1);return"-"==e||/\d/.test(n)?y(e,r,n.charCodeAt(0)-"0".charCodeAt(0)):console.error("invalid octave",n)},createSound:function(...t){return this.uploadPCM(this.createSoundBuffer(t))}}}();let app=arcajs.app=function(a="arcajs_canvas"){let i=[0,0,0],r={},o=null,l=null,h={},s=0,n={audio:arcajs.audio,intersects:arcajs.intersects},d=[],u=.1,c=0,e=!1,p=!1;"visible"in window.console||(window.console.visible=function(){});const t=document.getElementById(a);let f=new arcajs.Graphics(t);function m(t){var e=d[t];if(!e||!e.connected)return{index:t,connected:!1};var r=navigator.getGamepads()[t];let n={index:t,connected:!0,buttons:[],axes:[]};for(let t=0;t<r.buttons.length;++t)n.buttons[t]=r.buttons[t].pressed;for(let t=0;t<r.axes.length;++t)n.axes[t]=r.axes[t];return n}function v(t,e,r,n){if(!t.repeat){if("state"in v||(v.state={}),!(e in v.state)){const s=v.state[e]={axes:[],buttons:[]};if(r)for(var a=0;a<r.length;a+=2)s.axes.push(0);if(n)for(a=0;a<n.length;++a)s.buttons.push(!1);y.emit("gamepad",{index:e,type:"connect",axes:s.axes.length,buttons:s.buttons.length})}const s=v.state[e];var i="keydown"===t.type;if(i||"keyup"===t.type){if(r)for(a=0;a<r.length;++a)if(t.key===r[a]){var o=Math.floor(a/2),l=a%2?1:-1;if(i){if(s.axes[o]===l)return}else if(0===s.axes[o]||s.axes[o]!==l)return;return s.axes[o]=i?l:0,y.emit("gamepad",{index:e,type:"axis",axis:o,value:s.axes[o]})}if(n)for(a=0;a<n.length;++a){var h=n[a];if((t.key===h||"object"==typeof h&&t.key===h.key&&t.location==h.location)&&s.buttons[a]!=i)return s.buttons[a]=i,y.emit("gamepad",{index:e,type:"button",button:a,value:i?1:0})}}}}function g(t){return(255&t)<<24|(65280&t)<<8|t>>8&65280|t>>24&255}const y={version:"v0.20240908a",platform:"browser",width:window.innerWidth,height:window.innerHeight,pixelRatio:1,numControllers:0,args:(w={},0<=window.location.href.indexOf("?")&&window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,(t,e,r)=>{if(r.indexOf(",")<0)r=decodeURIComponent(r);else{r=r.split(",");for(let t=0;t<r.length;++t)r[t]=decodeURIComponent(r[t])}e in w?(Array.isArray(w[e])||(w[e]=[w[e]]),Array.isArray(r)?w[e]=w[e].concat(r):w[e].push(r)):w[e]=r}),w=1==Object.keys(w).length&&w.args?w.args:w),setBackground:function(t,e,r){Array.isArray(t)?(i[0]=t[0]/255,i[1]=t[1]/255,i[2]=t[2]/255):void 0===e?(i[0]=((4278190080&t)>>>24)/255,i[1]=((16711680&t)>>>16)/255,i[2]=((65280&t)>>>8)/255):(i[0]=t/255,i[1]=e/255,i[2]=r/255)},close:function(){1<history.length?history.back():("tv"===this.platform?window.open("","_self"):window).close()},on:function(t,e){if("object"==typeof t)return"load"in t&&this.on("load",t.load),"close"in t&&this.on("close",t.close),void(o=t);e?(r[t]=e,"gamepad"===t&&(l=e)):(delete r[t],"gamepad"===t&&(l=null))},emit:function(t,...e){t in r&&r[t](...e),"*"in r&&r["*"](t,...e)},emitAsGamepadEvent:v,getResource:function(r,n={}){if(Array.isArray(r)){let e=[];for(let t=0;t<r.length;++t)e.push(this.getResource(r[t],n));return e}var t=r.substr(r.lastIndexOf(".")+1).toLowerCase(),e=n.scale||1,a="svg"===t?r+"/"+e:r;if(a in h)return h[a];e=()=>{s<=0||0==--s&&setTimeout(()=>{this._run()},5)};let i=0;return"font"==n.type||"ttf"==t?i=f.loadFont(r,n,e):"png"==t||"jpg"==t||"svg"==t?i=f.loadTexture(r,n,e):"mp3"!=t&&"wav"!=t||(i=arcajs.audio.load(r,n,e)),i&&(++s,h[a]=i),i},createImageResource:function(...t){return f.createTexture(...t)},createCircleResource:function(t,e=[255,255,255,255],r=0,n=[255,255,255,255]){return f.createCircleTexture(t,e,r,n)},createPathResource:function(...t){return function(t,e,r,n=[255,255,255,255],a=0,i=[255,255,255,255]){let o=document.createElement("canvas");o.width=t,o.height=e;let l=o.getContext("2d");return l.lineWidth=a,l.fillStyle=n?"rgba("+n[0]+","+n[1]+","+n[2]+","+("number"==typeof n[3]?n[3]/255:1)+")":"transparent",l.strokeStyle=a?"rgba("+i[0]+","+i[1]+","+i[2]+","+("number"==typeof i[3]?i[3]/255:1)+")":"transparent",r=new Path2D(r),n&&l.fill(r),a&&l.stroke(r),r=new Uint8Array(l.getImageData(0,0,t,e).data.buffer),f.createTexture(t,e,r)}(...t)},createSVGResource:function(t,e){return e=e,(t=t).startsWith('<svg xmlns="http://www.w3.org/2000/svg"')||(t='<svg xmlns="http://www.w3.org/2000/svg"'+t.substr(4)),t=new Blob([t],{type:"image/svg+xml"}),f.loadTexture(URL.createObjectURL(t),e)},createTileResources:function(t,e,r=1,n=0,a){return f.createTileTextures(t,e,r,n,a)},createTileResource:function(t,e,r,n,a,i){return f.createTileTexture(t,e,r,n,a,i)},createImageFontResource:function(t,e){return f.createImageFontResource(t,e)},releaseResource:function(t,e){e.startsWith("image")?f.releaseTexture(t):e.startsWith("audio")&&audio.release(t)},setImageCenter:function(t,e,r){f.setTextureCenter(t,e,r)},queryImage:function(t){return f.queryTexture(t)},queryFont:function(t,e){return f.measureText(t,e)},setPointer:function(t){document.getElementById(a).style.cursor=t?"":"none"},httpGet:function(t,e){arcajs.http.get(t,null,e)},httpPost:function(t,e,r){arcajs.http.post(t,e,r)},openURL:function(t){window.open(t,"_blank")},createSpriteSet:function(...t){return arcajs.createSpriteSet(...t)},include:function(t,e){const r=document.createElement("script");r.type="text/javascript",r.src=t,r.async=!1,e&&r.addEventListener("load",e,!1),document.querySelector("head").appendChild(r)},require:function(t){return n[t]},exports:function(t,e){n[t]=e},resizable:function(t){},fullscreen:function(t){t?document.fullscreenEnabled&&!document.fullscreenElement?document.documentElement.requestFullscreen():document.webkitFullscreenEnabled&&!document.webkitFullscreenElement&&document.documentElement.webkitRequestFullscreen():document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()},vibrate:function(t){"vibrate"in navigator?navigator.vibrate(1e3*t):"mozVibrate"in navigator&&navigator.mozVibrate(1e3*t)},prompt:function(t,e,r){return Array.isArray(t)&&(t=t.join("\n")),window.prompt(t,e)},message:function(t,e){return Array.isArray(t)&&(t=t.join("\n")),e&&"button1"in e?window.confirm(t):window.alert(t)},hsl:function(t,e,r,n){function a(t,e,r){return r<0?r+=1:1<r&&--r,6*r<1?t+6*(e-t)*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}if(e<5e-6)return[r=Math.floor(255*r),r,r,n];if(isNaN(t))return[0,0,0,n];for(;360<=t;)t-=360;for(;t<0;)t+=360;e=r<.5?r*(1+e):r+e-e*r,r=2*r-e;return[Math.floor(255*a(r,e,t/360+1/3)),Math.floor(255*a(r,e,t/360)),Math.floor(255*a(r,e,t/360-1/3)),n]},createColorArray:function(){let t=new Uint32Array(arguments.length);for(var e=0;e<arguments.length;++e)t[e]=g(arguments[e]);return t},arrayColor:g,transformArray:function(r,n){const a=[],i=arguments[arguments.length-1];for(let t=2,e=arguments.length-1;t<e;++t)a.push(arguments[t]);for(let t=0,e=r.length;t<e;t+=n)i(r.slice(t,t+n),r.subarray(t,t+n),...a)},_getGamepad:m,_run:function(t=!1){e||(t&&(p=!0),!0===p&&!1===e&&0===s&&(y.emit("load"),e=!0,c=.001*document.timeline.currentTime),e&&setTimeout(()=>{requestAnimationFrame(T)},0))}};var w;const x=navigator.userAgent;(x.match(/AFT/)||x.match(/smart\-tv/i)||x.match(/smarttv/i))&&(y.platform="tv");const T=t=>{o&&function(){y.emit("leave");const r=o;["update","draw","resize","keyboard","pointer","gamepad","enter","leave","visibilitychange","textinput","custom","wheel"].forEach(function(e){e in r?y.on(e,function(...t){r[e](...t)}):y.on(e)}),y.emit("enter"),o=null}(),null!==l&&function(){for(let r=0,t=d.length;r<t;++r){const n=d[r];if(n&&n.connected){let e=m(r);if(null!==n.state){for(let t=0;t<e.buttons.length;++t)e.buttons[t]!=n.state.buttons[t]&&y.emit("gamepad",{type:"button",index:r,button:t,value:e.buttons[t]?1:0});for(let t=0;t<e.axes.length;++t)Math.round(e.axes[t]/u)!=Math.round(n.state.axes[t]/u)&&(e.axes[t]<.5*u&&e.axes[t]>.5*-u&&(e.axes[t]=0),y.emit("gamepad",{type:"axis",index:r,axis:t,value:e.axes[t]}))}n.state=e}}}();var e=(t*=.001)-c;c=t,y.emit("update",e,t);var r,n=document.getElementById(a);r=1,t=(e=n).clientWidth*r,r=e.clientHeight*r,e.width===t&&e.height===r||(e.width=t,e.height=r,y.emit("resize",e.clientWidth,e.clientHeight)),y.width=n.width,y.height=n.height,f._frameBegin(...i),y.emit("draw",f),f._frameEnd(),requestAnimationFrame(T)},b="tv"===y.platform?function(t){switch(t.key){case"MediaRewind":case"MediaFastForward":case"MediaPlayPause":case"ContextMenu":case"GoBack":t.stopImmediatePropagation(),t.stopPropagation(),t.preventDefault()}}:function(){};return document.body.addEventListener("touchmove",t=>{},{passive:!0}),window.addEventListener("unload",()=>{y.emit("close")}),window.addEventListener("keydown",t=>{b(t),t.ctrlKey&&"v"===t.key||("keyboard"in r||"textinput"in r)&&(y.emit("keyboard",t),function(t){if("textinput"in r)if(1==t.key.length){var e=t.key.charCodeAt(0);32<=e&&e<256&&y.emit("textinput",{type:"textinput",char:t.key})}else switch(t.key){case"Alt":case"AltGraph":case"CapsLock":case"Control":case"Shift":return;default:y.emit("textinput",{type:"textinput",key:t.key})}}(t),t.preventDefault())}),window.addEventListener("keyup",t=>{b(t),y.emit("keyboard",t)}),document.addEventListener("keypress",t=>{b(t)}),window.addEventListener("gamepadconnected",t=>{++y.numControllers,d[t.gamepad.index]={id:t.gamepad.id,connected:!0,state:null},y.emit("gamepad",{index:t.gamepad.index,name:t.gamepad.id,type:"connected",axes:t.gamepad.axes.length,buttons:t.gamepad.buttons.length})}),window.addEventListener("gamepaddisconnected",t=>{--y.numControllers,d[t.gamepad.index]={id:t.gamepad.id,connected:!1,state:null},y.emit("gamepad",{index:t.gamepad.index,name:t.gamepad.id,type:"disconnected"})}),t.addEventListener("dragover",t=>{t.preventDefault()}),t.addEventListener("drop",t=>{t.preventDefault(),t.dataTransfer.items?[...t.dataTransfer.items].forEach(t=>{if("file"===t.kind){const e=new FileReader;e.addEventListener("load",()=>{y.emit("textinsert",{type:"drop",data:e.result})}),e.readAsText(t.getAsFile())}else"string"===t.kind&&t.getAsString(t=>{t&&y.emit("textinsert",{type:"drop",data:t})})}):t.dataTransfer.files?[...t.dataTransfer.files].forEach(t=>{const e=new FileReader;e.addEventListener("load",()=>{y.emit("textinsert",{type:"drop",data:e.result})}),e.readAsText(t)}):(t=t.dataTransfer.getData("text/plain"))&&y.emit("textinsert",{type:"drop",data:t})}),window.addEventListener("paste",t=>{t.preventDefault();t=(t.clipboardData||window.clipboardData).getData("text");"string"==typeof t&&t.length&&y.emit("textinsert",{type:"paste",data:t})}),arcajs.infra.addPointerEventListener(t,t=>{y.emit("pointer",t)}),!("hidden"in document)&&"webkitHidden"in document?document.addEventListener("webkitvisibilitychange",()=>{y.emit("visibilitychange",{visible:!document.webkitHidden})}):document.addEventListener("visibilitychange",()=>{y.emit("visibilitychange",{visible:!document.hidden})}),document.addEventListener("pause",()=>{y.emit("visibilitychange",{visible:!1})},!1),document.addEventListener("resume",()=>{y.emit("visibilitychange",{visible:!0})},!1),document.addEventListener("wheel",t=>{y.emit("wheel",t),t.preventDefault()},!1),setTimeout(()=>{y.emit("resize",{width:t.width,height:t.height})},0),y}();
